---
title: "Rescorla Scrims 2"
author: "Zachary Houghton"
date: "2025-05-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Rescorla Predictions

Libraries:

```{r}
library(tidyverse)
library(ndl)
library(arm)
library(ggpubr)
#logistic perceptron from neural net
source("RescorlaLogistic.R")
```

Let's test what the RW predictions for our experiment are.

## Conditions Tables

Table1:

|  |  |  |  |  |  |  |  |  |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| **Condition1** | #of tokens | #of types | **Condition2** | #of tokens | #of types | **Condition3** | #of tokens | #of types |
| *dan* | 12 | 12 | *dan* | 12 | 3 | *dan* | 12 | 12 |
| *nem* | 12 | 3 | *nem* | 3 | 3 | *nem* | 3 | 3 |
| *sil* | 6 | 6 | *sil* | 6 | 6 | *sil* | 6 | 6 |
| *shoon* | 6 | 6 | *shoon* | 6 | 6 | *shoon* | 6 | 6 |
| **Condition4** |  |  | **Condition5** |  |  | **Condition6** | #of tokens | #of types |
| *dan* | 12 | 3 | *dan* | 3 | 3 | *dan* | 3 | 3 |
| *nem* | 12 | 12 | *nem* | 12 | 3 | *nem* | 12 | 12 |
| *sil* | 6 | 6 | *sil* | 6 | 6 | *sil* | 6 | 6 |
| *shoon* | 6 | 6 | *shoon* | 6 | 6 | *shoon* | 6 | 6 |

Table2

|  |  |  |  |  |  |  |  |  |
|--------|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
| **Condition** | **dan token** | **nem token** | **sil token** | **shoon token** | **dan type** | **nem type** | **sil type** | **shoon type** |
| 1 | 12 | 12 | 6 | 6 | 12 | 3 | 6 | 6 |
| 2 | 12 | 3 | 6 | 6 | 3 | 3 | 6 | 6 |
| 3 | 12 | 3 | 6 | 6 | 12 | 3 | 6 | 6 |
| 4 | 12 | 12 | 6 | 6 | 3 | 12 | 6 | 6 |
| 5 | 3 | 12 | 6 | 6 | 3 | 3 | 6 | 6 |
| 6 | 3 | 12 | 6 | 6 | 3 | 12 | 6 | 6 |

## Condition 1 (dan type): 12 token, 12 type (nem 12 tokens 3 types)

### Preparing Data

```{r}
cond1 = read_csv('../Conditions/Condition1.csv') 
cond1 = cond1 %>%
  mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond1 = cond1 %>%
  mutate(key = paste0(stem, '_', type))

cond1_key = cond1 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond1_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond1 = cond1_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5) %>% 
  mutate(Cues = paste0("cx_", Cues))

```

### Rescorla Predictions

We'll use the RW-model with logistic function.

As a reminder, the question we're investigating is whether type or token frequency (or some combination of both) affects the generalizability of a morpheme (this is operationalized as whether type or token frequency affects the *associability,* or the weight, of one cue with the plural outcome outcome).

```{r}
n = 1
b = sqrt(0.02)
b2 = 0.1
a = sqrt(0.02)
a2 = 0.1
lambda = 1
#lambda0 = 1
ap_setting = F

big_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2) #ap = T means you're learning something if the cue is absent 
pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
#big_dan_cond1_test = RescorlaLogistic(data_cond1_test, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

dim_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

big_pl_dan_cond1 = big_dan_cond1$weightvector + pl_dan_cond1$weightvector
dim_pl_dan_cond1 = dim_dan_cond1$weightvector + pl_dan_cond1$weightvector
big_pl_nem_cond1 = big_nem_cond1$weightvector + pl_nem_cond1$weightvector
dim_pl_nem_cond1 = dim_nem_cond1$weightvector + pl_nem_cond1$weightvector

sg_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond1 = dim_nem_cond1$weightvector + sg_nem_cond1$weightvector

plot(big_pl_dan_cond1, type='l' )
plot(dim_pl_dan_cond1, type = 'l')

plot(big_pl_nem_cond1, type = 'l')
plot(dim_pl_nem_cond1, type = 'l')

plot(big_pl_dan_cond1 - big_pl_nem_cond1, type = 'l')
plot(dim_pl_dan_cond1 - dim_pl_nem_cond1, type = 'l')


```

## Condition 2 (dan token): 12 tokens, 3 types

```{r}

cond2 = read_csv('../Conditions/Condition2.csv') 
cond2 = cond2 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond2 = cond2 %>%
  mutate(key = paste0(stem, '_', type))

cond2_key = cond2 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond2_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond2 = cond2_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5) %>% 
  mutate(Cues = paste0("cx_", Cues))
```

### Rescorla Predictions

```{r}


cx_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

sg_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond2 = dim_nem_cond2$weightvector + sg_nem_cond2$weightvector

big_pl_dan_cond2 = big_dan_cond2$weightvector + pl_dan_cond2$weightvector
dim_pl_dan_cond2 = dim_dan_cond2$weightvector + pl_dan_cond2$weightvector
big_pl_nem_cond2 = big_nem_cond2$weightvector + pl_nem_cond2$weightvector
dim_pl_nem_cond2 = dim_nem_cond2$weightvector + pl_nem_cond2$weightvector


plot(big_pl_dan_cond2, type='l' )
plot(dim_pl_dan_cond2, type = 'l')

plot(big_pl_nem_cond2, type = 'l')
plot(dim_pl_nem_cond2, type = 'l')

plot(big_pl_dan_cond2 - big_pl_nem_cond2, type = 'l')
plot(dim_pl_dan_cond2 - dim_pl_nem_cond2, type = 'l')

```

## Condition 3 (dan type and token): 12 tokens, 12 types (nem 3 tokens, 3 types)

```{r}

cond3 = read_csv('../Conditions/Condition3.csv') 
cond3 = cond3 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond3 = cond3 %>%
  mutate(key = paste0(stem, '_', type))

cond3_key = cond3 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond3_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond3 = cond3_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5) %>% 
  mutate(Cues = paste0("cx_", Cues))
```

### Rescorla Predictions

```{r}


cx_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)
sg_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond3 = dim_nem_cond3$weightvector + sg_nem_cond3$weightvector

big_pl_dan_cond3 = big_dan_cond3$weightvector + pl_dan_cond3$weightvector
dim_pl_dan_cond3 = dim_dan_cond3$weightvector + pl_dan_cond3$weightvector
big_pl_nem_cond3 = big_nem_cond3$weightvector + pl_nem_cond3$weightvector
dim_pl_nem_cond3 = dim_nem_cond3$weightvector + pl_nem_cond3$weightvector


plot(big_pl_dan_cond3, type='l' )
plot(dim_pl_dan_cond3, type = 'l')

plot(big_pl_nem_cond3, type = 'l')
plot(dim_pl_nem_cond3, type = 'l')

plot(big_pl_dan_cond3 - big_pl_nem_cond3, type = 'l')
plot(dim_pl_dan_cond3 - dim_pl_nem_cond3, type = 'l')

cx_dan_cond1 = cx_dan_cond1$weightvector
cx_dan_cond2 = cx_dan_cond2$weightvector
cx_dan_cond3 = cx_dan_cond3$weightvector

cx_nem_cond1 = cx_nem_cond1$weightvector
cx_nem_cond2 = cx_nem_cond2$weightvector
cx_nem_cond3 = cx_nem_cond3$weightvector
```
```{r}


a1 = a
a2 = a2
b1 = b
b2 = b2
ap_setting = ap_setting

process_trace_cue = function(full_string, trace_outcome, b2, a1, b1, a2, ap_setting, data_df) {
  substrings = strsplit(full_string, "_")[[1]]
  
  #empty_dataframe = data.frame()
  result_list = map(substrings, function(cue) {
    out = RescorlaLogistic(
      data_df, 
      nruns = n,
      traceCue = cue,
      traceOutcome = trace_outcome, 
      beta2 = b2,
      alpha = a1,
      beta1 = b1,
      ap = ap_setting
    )

    out_tibble = as_tibble_col(out$weightvector) %>%
      set_names(cue)
    
    
    return(out_tibble)
  }) 
    final_df = bind_cols(result_list) %>%
      mutate(totalweight = rowSums(across(where(is.numeric)), na.rm = T),
             traceCue_combined = full_string) %>%
      dplyr::select(totalweight, traceCue_combined) %>%
      mutate(Index = row_number())
    
  return(final_df)
}
familiar_stems_cond1 = c('bal', 'berko', 'kora', 'nako', 'pipa', 'bani', 'chool', 'kudom', 'osto', 'vorke', 'bin', 'mero')
familiar_stems_cond1 = unname(orthoCoding(familiar_stems_cond1))


familiar_stems_cond2 = c('bal', 'berko', 'kora')
familiar_stems_cond2 = unname(orthoCoding(familiar_stems_cond2))

familiar_stems_cond3 = c('bal', 'berko', 'kora', 'nako', 'pipa', 'bani', 'chool', 'kudom', 'osto', 'vorke', 'bin', 'mero')
familiar_stems_cond3 = unname(orthoCoding(familiar_stems_cond3))


novel_stems = c('pil', 'shinti', 'mero')
novel_stems = orthoCoding(novel_stems)


results_familiar_stems_dan_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



results_familiar_stems_dan_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_familiar_stems_dan_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2,  ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

```



## without subtracting out infrequent

```{r}


familiar_big_pl_dan_cond1 = big_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1
familiar_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

novel_big_pl_dan_cond1 = big_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1 
novel_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

familiar_big_pl_nem_cond1 = big_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
familiar_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
 
novel_big_pl_nem_cond1 = big_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)` #+ cx_nem_cond1


familiar_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1


#### Plot:

plot_familiar_big_pl_dan_cond1 = data.frame(weights = familiar_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond1 = data.frame(weights = familiar_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond1 = data.frame(weights = novel_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond1 = data.frame(weights = novel_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond1 = data.frame(weights = familiar_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond1 = data.frame(weights = familiar_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond1 = data.frame(weights = novel_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond1 = data.frame(weights = novel_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond1 = bind_rows(plot_familiar_big_pl_dan_cond1,
                              plot_familiar_dim_pl_dan_cond1,
                              plot_novel_big_pl_dan_cond1,
                              plot_novel_dim_pl_dan_cond1,
                              plot_familiar_dim_sg_nem_cond1,
                              plot_familiar_dim_pl_nem_cond1,
                              plot_novel_dim_sg_nem_cond1,
                              plot_novel_dim_pl_nem_cond1) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond1 = ggplot(plot_df_stems_all_cond1, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

plot_df_stems_cond1

```

```{r}



familiar_big_pl_dan_cond2 = big_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2
familiar_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 

novel_big_pl_dan_cond2 = big_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2 
novel_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 


familiar_big_pl_nem_cond2 = big_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)`   + cx_nem_cond2
familiar_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 

novel_big_pl_nem_cond2 = big_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 


familiar_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2


#### Plot:

plot_familiar_big_pl_dan_cond2 = data.frame(weights = familiar_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond2 = data.frame(weights = familiar_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond2 = data.frame(weights = novel_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond2 = data.frame(weights = novel_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond2 = data.frame(weights = familiar_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond2 = data.frame(weights = familiar_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond2 = data.frame(weights = novel_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond2 = data.frame(weights = novel_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond2 = bind_rows(plot_familiar_big_pl_dan_cond2,
                              plot_familiar_dim_pl_dan_cond2,
                              plot_novel_big_pl_dan_cond2,
                              plot_novel_dim_pl_dan_cond2,
                              plot_familiar_dim_sg_nem_cond2,
                              plot_familiar_dim_pl_nem_cond2,
                              plot_novel_dim_sg_nem_cond2,
                              plot_novel_dim_pl_nem_cond2) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond2 = ggplot(plot_df_stems_all_cond2, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

plot_df_stems_cond2

#write_csv(plot_df_stems_all_cond2, '../Data/plot_df_stems_all_cond2.csv')

```

```{r}
familiar_big_pl_dan_cond3 = big_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
familiar_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 

novel_big_pl_dan_cond3 = big_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
novel_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3  


familiar_big_pl_nem_cond3 = big_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
familiar_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3

novel_big_pl_nem_cond3 = big_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
novel_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


familiar_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3
novel_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3


#### Plot:

plot_familiar_big_pl_dan_cond3 = data.frame(weights = familiar_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond3 = data.frame(weights = familiar_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond3 = data.frame(weights = novel_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond3 = data.frame(weights = novel_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond3 = data.frame(weights = familiar_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond3 = data.frame(weights = familiar_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond3 = data.frame(weights = novel_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond3 = data.frame(weights = novel_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond3 = bind_rows(plot_familiar_big_pl_dan_cond3,
                              plot_familiar_dim_pl_dan_cond3,
                              plot_novel_big_pl_dan_cond3,
                              plot_novel_dim_pl_dan_cond3,
                              plot_familiar_dim_sg_nem_cond3,
                              plot_familiar_dim_pl_nem_cond3,
                              plot_novel_dim_sg_nem_cond3,
                              plot_novel_dim_pl_nem_cond3) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))


#write_csv(plot_df_stems_all_cond3, '../Data/plot_df_stems_all_cond3.csv')

plot_df_stems_cond3 = ggplot(plot_df_stems_all_cond3, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type-Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

plot_df_stems_cond3


```

### full plot

```{r}
ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)
```
## Freq to infreq prop
```{r}
cond1_estimates = plot_df_stems_all_cond1 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights, row_number) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type Frequency')


cond2_estimates = plot_df_stems_all_cond2 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Token Frequency')

cond3_estimates = plot_df_stems_all_cond3 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type-Token Frequency')


all_cond_estimates = rbind(cond1_estimates, cond2_estimates, cond3_estimates) %>%
  mutate(label = paste(Stem, Meaning))


all_cond_estimates = all_cond_estimates %>%
  mutate(freq = invlogit(Frequent),
         infreq = invlogit(Infrequent),
         freq_probs = freq / (freq + infreq))
         

#write_csv(all_cond_estimates, '../Data/all_cond_estimates.csv')
  
all_cond_estimates$Condition = factor(all_cond_estimates$Condition, levels = c('Type Frequency', 'Token Frequency', 'Type-Token Frequency'))

ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_to_infreq, fill = Meaning), position='dodge') +
  facet_wrap(~Stem) +
  theme_bw()


```


Systematic manipulation:

-every combination of a,a2,b,b2,etc
-run for every combination, plot:

## Sims
```{r}
alphas = seq(from = 0, by = 0.01, length.out = 10)
betas = seq(from = 0, by = 0.01, length.out = 10)
alpha2s = seq(from = 0, by = 0.01, length.out = 10)
beta2s = seq(from = 0, by = 0.01, length.out = 10)


plot_function = function(a1, a2, b1, b2, ap_setting) {
  
b2 = b2
a = a1
b = b1
a2 = a2

big_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2) #ap = T means you're learning something if the cue is absent 
pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
#big_dan_cond1_test = RescorlaLogistic(data_cond1_test, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

dim_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

big_pl_dan_cond1 = big_dan_cond1$weightvector + pl_dan_cond1$weightvector
dim_pl_dan_cond1 = dim_dan_cond1$weightvector + pl_dan_cond1$weightvector
big_pl_nem_cond1 = big_nem_cond1$weightvector + pl_nem_cond1$weightvector
dim_pl_nem_cond1 = dim_nem_cond1$weightvector + pl_nem_cond1$weightvector

sg_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond1 = dim_nem_cond1$weightvector + sg_nem_cond1$weightvector


cx_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

sg_nem_cond2 = RescorlaLogistic(data_cond2, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond2 = dim_nem_cond2$weightvector + sg_nem_cond2$weightvector

big_pl_dan_cond2 = big_dan_cond2$weightvector + pl_dan_cond2$weightvector
dim_pl_dan_cond2 = dim_dan_cond2$weightvector + pl_dan_cond2$weightvector
big_pl_nem_cond2 = big_nem_cond2$weightvector + pl_nem_cond2$weightvector
dim_pl_nem_cond2 = dim_nem_cond2$weightvector + pl_nem_cond2$weightvector
  

cx_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)
sg_nem_cond3 = RescorlaLogistic(data_cond3, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond3 = dim_nem_cond3$weightvector + sg_nem_cond3$weightvector

big_pl_dan_cond3 = big_dan_cond3$weightvector + pl_dan_cond3$weightvector
dim_pl_dan_cond3 = dim_dan_cond3$weightvector + pl_dan_cond3$weightvector
big_pl_nem_cond3 = big_nem_cond3$weightvector + pl_nem_cond3$weightvector
dim_pl_nem_cond3 = dim_nem_cond3$weightvector + pl_nem_cond3$weightvector


cx_dan_cond1 = cx_dan_cond1$weightvector
cx_dan_cond2 = cx_dan_cond2$weightvector
cx_dan_cond3 = cx_dan_cond3$weightvector

cx_nem_cond1 = cx_nem_cond1$weightvector
cx_nem_cond2 = cx_nem_cond2$weightvector
cx_nem_cond3 = cx_nem_cond3$weightvector



process_trace_cue = function(full_string, trace_outcome, b2, a1, b1, a2, ap_setting, data_df) {
  substrings = strsplit(full_string, "_")[[1]]
  
  #empty_dataframe = data.frame()
  result_list = map(substrings, function(cue) {
    out = RescorlaLogistic(
      data_df, 
      nruns = n,
      traceCue = cue,
      traceOutcome = trace_outcome, 
      beta2 = b2,
      alpha = a1,
      beta1 = b1,
      alpha2 = a2,
      ap = ap_setting
    )

    out_tibble = as_tibble_col(out$weightvector) %>%
      set_names(cue)
    
    
    return(out_tibble)
  }) 
    final_df = bind_cols(result_list) %>%
      mutate(totalweight = rowSums(across(where(is.numeric)), na.rm = T),
             traceCue_combined = full_string) %>%
      dplyr::select(totalweight, traceCue_combined) %>%
      mutate(Index = row_number())
    
  return(final_df)
}


results_familiar_stems_dan_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



results_familiar_stems_dan_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_familiar_stems_dan_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))




familiar_big_pl_dan_cond1 = big_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1
familiar_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

novel_big_pl_dan_cond1 = big_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1 
novel_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

familiar_big_pl_nem_cond1 = big_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
familiar_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
 
novel_big_pl_nem_cond1 = big_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)` #+ cx_nem_cond1


familiar_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1


#### Plot:

plot_familiar_big_pl_dan_cond1 = data.frame(weights = familiar_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond1 = data.frame(weights = familiar_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond1 = data.frame(weights = novel_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond1 = data.frame(weights = novel_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond1 = data.frame(weights = familiar_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond1 = data.frame(weights = familiar_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond1 = data.frame(weights = novel_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond1 = data.frame(weights = novel_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond1 = bind_rows(plot_familiar_big_pl_dan_cond1,
                              plot_familiar_dim_pl_dan_cond1,
                              plot_novel_big_pl_dan_cond1,
                              plot_novel_dim_pl_dan_cond1,
                              plot_familiar_dim_sg_nem_cond1,
                              plot_familiar_dim_pl_nem_cond1,
                              plot_novel_dim_sg_nem_cond1,
                              plot_novel_dim_pl_nem_cond1) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond1 = ggplot(plot_df_stems_all_cond1, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

#plot_df_stems_cond1



familiar_big_pl_dan_cond2 = big_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2
familiar_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 

novel_big_pl_dan_cond2 = big_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2 
novel_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 


familiar_big_pl_nem_cond2 = big_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)`   + cx_nem_cond2
familiar_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 

novel_big_pl_nem_cond2 = big_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 


familiar_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2


#### Plot:

plot_familiar_big_pl_dan_cond2 = data.frame(weights = familiar_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond2 = data.frame(weights = familiar_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond2 = data.frame(weights = novel_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond2 = data.frame(weights = novel_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond2 = data.frame(weights = familiar_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond2 = data.frame(weights = familiar_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond2 = data.frame(weights = novel_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond2 = data.frame(weights = novel_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond2 = bind_rows(plot_familiar_big_pl_dan_cond2,
                              plot_familiar_dim_pl_dan_cond2,
                              plot_novel_big_pl_dan_cond2,
                              plot_novel_dim_pl_dan_cond2,
                              plot_familiar_dim_sg_nem_cond2,
                              plot_familiar_dim_pl_nem_cond2,
                              plot_novel_dim_sg_nem_cond2,
                              plot_novel_dim_pl_nem_cond2) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond2 = ggplot(plot_df_stems_all_cond2, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


familiar_big_pl_dan_cond3 = big_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
familiar_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 

novel_big_pl_dan_cond3 = big_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
novel_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3  


familiar_big_pl_nem_cond3 = big_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
familiar_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3

novel_big_pl_nem_cond3 = big_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
novel_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


familiar_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3
novel_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3


#### Plot:

plot_familiar_big_pl_dan_cond3 = data.frame(weights = familiar_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond3 = data.frame(weights = familiar_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond3 = data.frame(weights = novel_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond3 = data.frame(weights = novel_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond3 = data.frame(weights = familiar_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond3 = data.frame(weights = familiar_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond3 = data.frame(weights = novel_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond3 = data.frame(weights = novel_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond3 = bind_rows(plot_familiar_big_pl_dan_cond3,
                              plot_familiar_dim_pl_dan_cond3,
                              plot_novel_big_pl_dan_cond3,
                              plot_novel_dim_pl_dan_cond3,
                              plot_familiar_dim_sg_nem_cond3,
                              plot_familiar_dim_pl_nem_cond3,
                              plot_novel_dim_sg_nem_cond3,
                              plot_novel_dim_pl_nem_cond3) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))


write_csv(plot_df_stems_all_cond1, '../Data/plot_df_stems_all_cond1.csv')
write_csv(plot_df_stems_all_cond2, '../Data/plot_df_stems_all_cond2.csv')
write_csv(plot_df_stems_all_cond3, '../Data/plot_df_stems_all_cond3.csv')

plot_df_stems_cond3 = ggplot(plot_df_stems_all_cond3, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type-Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

cond1_estimates = plot_df_stems_all_cond1 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type Frequency')


cond2_estimates = plot_df_stems_all_cond2 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Token Frequency')

cond3_estimates = plot_df_stems_all_cond3 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type-Token Frequency')


all_cond_estimates = rbind(cond1_estimates, cond2_estimates, cond3_estimates) %>%
  mutate(label = paste(Stem, Meaning))


all_cond_estimates = all_cond_estimates %>%
  mutate(freq = invlogit(Frequent),
         infreq = invlogit(Infrequent),
         freq_probs = freq / (freq + infreq),
         freq_probs_linear = freq - infreq)
         

write_csv(all_cond_estimates, '../Data/all_cond_estimates.csv')
  
all_cond_estimates$Condition = factor(all_cond_estimates$Condition, levels = c('Type Frequency', 'Token Frequency', 'Type-Token Frequency'))



p1 = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_probs, fill = Meaning), position='dodge') +
  ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p1b = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_to_infreq, fill = Meaning), position='dodge') +
  #ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p2 = ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

tibble(p1 = list(p1), p1b = list(p1b), p2 = list(p2), all_cond_estimates)

}


```

## test sims

```{r}
#a1 = runif(1, min=0, max = 0.7)
#a2 = runif(1, min=0, max = 0.7)
#b1 = runif(1, min=0, max = 0.7)
#b2 = runif(1, min=0, max = 0.7)
n = 1
b1 = 0.1
b2 = 0.2
a1 = 0.5
#a2 = 1 #changing a2 doesn't do anything if ap_setting = F
lambda = 1
ap_setting = F

run1 = plot_function(a1 = a1, a2 = a2, b1 = b1, b2 = b2, ap_setting = F)



# n = 1
# b1 = 0.2
# b2 = 0.1
# a1 = 0.4
# a2 = 0.1
#run1 = plot_function_linear(a1 = a1, a2 = a2, b1 = b1, b2 = b2, ap_setting = F)

run1$p1b[[1]]
#run1$p1[[1]]



#run1$`list(all_cond_estimates)`
```
```{r}
n = 1
b1 = 0.25
b2 = 0.2
a1 = 0.4
#a2 = 0.1
run1 = plot_function_linear(a1 = a1, a2 = a2, b1 = b1, b2 = b2, ap_setting = F)

run1$p1b[[1]]
```


```{r}

alphas = seq(from = 0.1, to = 0.3, by = 0.1)
betas = seq(from = 0.1, to = 0.3, by = 0.1)
alpha2s = seq(from = 0.1, to = 0.3, by = 0.1)
beta2s = seq(from = 0.1, to = 0.3, by = 0.1)


#alphas = seq(from = 0, to = 1, by = 0.2)
#alpha2s = alphas

df = expand.grid(alphas = alphas, alpha2s = alpha2s, betas = betas, beta2s = beta2s) 

# sims_run = df %>%
#   mutate(plot_data = pmap(., ~ plot_function(..1, ..2, ..3, ..4, ap = T))) %>%
#   unnest_wider(plot_data)

sims_run2 = df %>%
  mutate(plot_data = pmap(., ~ plot_function(..1, ..2, ..3, ..4, ap = F))) %>%
  unnest_wider(plot_data)

#walk(sims_run$p1, print) #print all the plots
sims_run2 = sims_run2 %>%
  mutate(p1b = map(p1b, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1b)) {
  ggsave(
    filename = paste0("../Plots/RW-Logistic/plot_p1_v2_", i, ".png"),
    plot = sims_run2$p1b[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}
```

```{r}
library(purrr)

#walk(sims_run$p1, print) #print all the plots
sims_run = sims_run %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Logistic/plot_p1_", i, ".png"),
    plot = sims_run$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}
#walk(sims_run$p1, print) #print all the plots
sims_run2 = sims_run2 %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Logistic/plot_p1_v2_", i, ".png"),
    plot = sims_run2$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

```

## Rescorla Linear

```{r}
alphas = seq(from = 0, to = 1, by = 0.1)
betas = seq(from = 0, to = 1, by = 0.1)
alpha2s = seq(from = 0, to = 1, by = 0.1)
beta2s = seq(from = 0, to = 1, by = 0.1)


plot_function_linear = function(a1, a2, b1, b2, ap_setting) {
  
b2 = b2
a = a1
b = b1
a2 = a2
big_dan_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2) #ap = T means you're learning something if the cue is absent 
pl_dan_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_dan_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
#big_dan_cond1_test = RescorlaLogistic(data_cond1_test, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

dim_dan_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

big_pl_dan_cond1 = big_dan_cond1$weightvector + pl_dan_cond1$weightvector
dim_pl_dan_cond1 = dim_dan_cond1$weightvector + pl_dan_cond1$weightvector
big_pl_nem_cond1 = big_nem_cond1$weightvector + pl_nem_cond1$weightvector
dim_pl_nem_cond1 = dim_nem_cond1$weightvector + pl_nem_cond1$weightvector

sg_nem_cond1 = RescorlaLinear(data_cond1, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond1 = dim_nem_cond1$weightvector + sg_nem_cond1$weightvector


cx_dan_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

sg_nem_cond2 = RescorlaLinear(data_cond2, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond2 = dim_nem_cond2$weightvector + sg_nem_cond2$weightvector

big_pl_dan_cond2 = big_dan_cond2$weightvector + pl_dan_cond2$weightvector
dim_pl_dan_cond2 = dim_dan_cond2$weightvector + pl_dan_cond2$weightvector
big_pl_nem_cond2 = big_nem_cond2$weightvector + pl_nem_cond2$weightvector
dim_pl_nem_cond2 = dim_nem_cond2$weightvector + pl_nem_cond2$weightvector
  

cx_dan_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

big_nem_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)
sg_nem_cond3 = RescorlaLinear(data_cond3, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
dim_sg_nem_cond3 = dim_nem_cond3$weightvector + sg_nem_cond3$weightvector

big_pl_dan_cond3 = big_dan_cond3$weightvector + pl_dan_cond3$weightvector
dim_pl_dan_cond3 = dim_dan_cond3$weightvector + pl_dan_cond3$weightvector
big_pl_nem_cond3 = big_nem_cond3$weightvector + pl_nem_cond3$weightvector
dim_pl_nem_cond3 = dim_nem_cond3$weightvector + pl_nem_cond3$weightvector


cx_dan_cond1 = cx_dan_cond1$weightvector
cx_dan_cond2 = cx_dan_cond2$weightvector
cx_dan_cond3 = cx_dan_cond3$weightvector

cx_nem_cond1 = cx_nem_cond1$weightvector
cx_nem_cond2 = cx_nem_cond2$weightvector
cx_nem_cond3 = cx_nem_cond3$weightvector



process_trace_cue = function(full_string, trace_outcome, b2, a1, b1, a2, ap_setting, data_df) {
  substrings = strsplit(full_string, "_")[[1]]
  
  #empty_dataframe = data.frame()
  result_list = map(substrings, function(cue) {
    out = RescorlaLinear(
      data_df, 
      nruns = n,
      traceCue = cue,
      traceOutcome = trace_outcome, 
      beta2 = b2,
      alpha = a1,
      beta1 = b1,
      alpha2 = a2,
      ap = ap_setting
    )

    out_tibble = as_tibble_col(out$weightvector) %>%
      set_names(cue)
    
    
    return(out_tibble)
  }) 
    final_df = bind_cols(result_list) %>%
      mutate(totalweight = rowSums(across(where(is.numeric)), na.rm = T),
             traceCue_combined = full_string) %>%
      dplyr::select(totalweight, traceCue_combined) %>%
      mutate(Index = row_number())
    
  return(final_df)
}


results_familiar_stems_dan_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



results_familiar_stems_dan_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_familiar_stems_dan_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))




familiar_big_pl_dan_cond1 = big_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1
familiar_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

novel_big_pl_dan_cond1 = big_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1 
novel_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

familiar_big_pl_nem_cond1 = big_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
familiar_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
 
novel_big_pl_nem_cond1 = big_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
novel_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)` #+ cx_nem_cond1


familiar_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
novel_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1


#### Plot:

plot_familiar_big_pl_dan_cond1 = data.frame(weights = familiar_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond1 = data.frame(weights = familiar_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond1 = data.frame(weights = novel_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond1 = data.frame(weights = novel_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond1 = data.frame(weights = familiar_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond1 = data.frame(weights = familiar_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond1 = data.frame(weights = novel_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond1 = data.frame(weights = novel_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond1 = bind_rows(plot_familiar_big_pl_dan_cond1,
                              plot_familiar_dim_pl_dan_cond1,
                              plot_novel_big_pl_dan_cond1,
                              plot_novel_dim_pl_dan_cond1,
                              plot_familiar_dim_sg_nem_cond1,
                              plot_familiar_dim_pl_nem_cond1,
                              plot_novel_dim_sg_nem_cond1,
                              plot_novel_dim_pl_nem_cond1) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond1 = ggplot(plot_df_stems_all_cond1, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

#plot_df_stems_cond1



familiar_big_pl_dan_cond2 = big_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2
familiar_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 

novel_big_pl_dan_cond2 = big_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 
novel_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 


familiar_big_pl_nem_cond2 = big_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)`   #+ cx_nem_cond2
familiar_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 

novel_big_pl_nem_cond2 = big_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2
novel_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 


familiar_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2
novel_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2


#### Plot:

plot_familiar_big_pl_dan_cond2 = data.frame(weights = familiar_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond2 = data.frame(weights = familiar_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond2 = data.frame(weights = novel_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond2 = data.frame(weights = novel_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond2 = data.frame(weights = familiar_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond2 = data.frame(weights = familiar_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond2 = data.frame(weights = novel_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond2 = data.frame(weights = novel_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond2 = bind_rows(plot_familiar_big_pl_dan_cond2,
                              plot_familiar_dim_pl_dan_cond2,
                              plot_novel_big_pl_dan_cond2,
                              plot_novel_dim_pl_dan_cond2,
                              plot_familiar_dim_sg_nem_cond2,
                              plot_familiar_dim_pl_nem_cond2,
                              plot_novel_dim_sg_nem_cond2,
                              plot_novel_dim_pl_nem_cond2) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond2 = ggplot(plot_df_stems_all_cond2, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


familiar_big_pl_dan_cond3 = big_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 
familiar_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 

novel_big_pl_dan_cond3 = big_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 
novel_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3  


familiar_big_pl_nem_cond3 = big_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3 
familiar_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3

novel_big_pl_nem_cond3 = big_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3 
novel_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


familiar_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3
novel_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


#### Plot:

plot_familiar_big_pl_dan_cond3 = data.frame(weights = familiar_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond3 = data.frame(weights = familiar_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond3 = data.frame(weights = novel_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond3 = data.frame(weights = novel_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond3 = data.frame(weights = familiar_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond3 = data.frame(weights = familiar_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond3 = data.frame(weights = novel_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond3 = data.frame(weights = novel_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond3 = bind_rows(plot_familiar_big_pl_dan_cond3,
                              plot_familiar_dim_pl_dan_cond3,
                              plot_novel_big_pl_dan_cond3,
                              plot_novel_dim_pl_dan_cond3,
                              plot_familiar_dim_sg_nem_cond3,
                              plot_familiar_dim_pl_nem_cond3,
                              plot_novel_dim_sg_nem_cond3,
                              plot_novel_dim_pl_nem_cond3) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))


write_csv(plot_df_stems_all_cond1, '../Data/plot_df_stems_all_cond1.csv')
write_csv(plot_df_stems_all_cond2, '../Data/plot_df_stems_all_cond2.csv')
write_csv(plot_df_stems_all_cond3, '../Data/plot_df_stems_all_cond3.csv')

plot_df_stems_cond3 = ggplot(plot_df_stems_all_cond3, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type-Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

cond1_estimates = plot_df_stems_all_cond1 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type Frequency')


cond2_estimates = plot_df_stems_all_cond2 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Token Frequency')

cond3_estimates = plot_df_stems_all_cond3 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type-Token Frequency')


all_cond_estimates = rbind(cond1_estimates, cond2_estimates, cond3_estimates) %>%
  mutate(label = paste(Stem, Meaning))


all_cond_estimates = all_cond_estimates %>%
  mutate(freq = Frequent,
         infreq = Infrequent,
         freq_probs = freq / (freq + infreq))
         

write_csv(all_cond_estimates, '../Data/all_cond_estimates.csv')
  
all_cond_estimates$Condition = factor(all_cond_estimates$Condition, levels = c('Type Frequency', 'Token Frequency', 'Type-Token Frequency'))



p1 = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_probs, fill = Meaning), position='dodge') +
  ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p1b = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_to_infreq, fill = Meaning), position='dodge') +
  #ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p2 = ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

tibble(p1 = list(p1), p1b = list(p1b), p2 = list(p2), all_cond_estimates)

}

```

```{r}
run2 = plot_function_linear(a1 = 0.1, a2 = 0.1, b1 = 0.1, b2 = 0.1, ap_setting = F)

run2$p1[[1]]
run2$p2[[1]]
```
```{r}

alphas = seq(from = 0.1, to = 0.3, by = 0.1)
betas = seq(from = 0.1, to = 0.3, by = 0.1)
alpha2s = seq(from = 0.1, to = 0.3, by = 0.1)
beta2s = seq(from = 0.1, to = 0.3, by = 0.1)

#alphas = seq(from = 0, to = 1, by = 0.2)
#alpha2s = alphas

df = expand.grid(alphas = alphas, alpha2s = alpha2s, betas = betas, beta2s = beta2s)
#df = df %>% slice_head(n=2)


sims_run2 = df %>%
  mutate(plot_data = pmap(., ~ plot_function_linear(..1, ..2, ..3, ..4, ap = F))) %>%
  unnest_wider(plot_data)

sims_run2 = sims_run2 %>%
  mutate(p1b = map(p1b, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1b)) {
  ggsave(
    filename = paste0("../Plots/RW-Linear/plot_p1_v1b_", i, ".png"),
    plot = sims_run2$p1b[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

sims_run2 = sims_run2 %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Linear/plot_p1_v1_", i, ".png"),
    plot = sims_run2$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}


sims_run = df %>%
  mutate(plot_data = pmap(., ~ plot_function_linear(..1, ..2, ..3, ..4, ap = T))) %>%
  unnest_wider(plot_data)

sims_run = sims_run %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Linear/plot_p1_v2_", i, ".png"),
    plot = sims_run$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

sims_run = sims_run %>%
  mutate(p1b = map(p1b, ~ .x[[1]]))

for (i in seq_along(sims_run$p1b)) {
  ggsave(
    filename = paste0("../Plots/RW-Linear/plot_p1_v2b", i, ".png"),
    plot = sims_run$p1b[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

```

```{r}
library(purrr)

#walk(sims_run$p1, print) #print all the plots

#walk(sims_run$p1, print) #print all the plots


```

## Interaction data
```{r}
data_cond1_interaction = data_cond1 %>%
  mutate(Cues = case_when(
    Outcomes == 'dan' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'sil' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'none' ~ paste0(Cues, '_big.sg'),
    Outcomes == 'nem' ~ paste0(Cues, '_dim.sg'),
    Outcomes == 'shoon' ~ paste0(Cues, '_dim.sg')
  ))
  
data_cond2_interaction = data_cond2 %>%
  mutate(Cues = case_when(
    Outcomes == 'dan' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'sil' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'none' ~ paste0(Cues, '_big.sg'),
    Outcomes == 'nem' ~ paste0(Cues, '_dim.sg'),
    Outcomes == 'shoon' ~ paste0(Cues, '_dim.sg')
  ))

data_cond3_interaction = data_cond3 %>%
  mutate(Cues = case_when(
    Outcomes == 'dan' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'sil' ~ paste0(Cues, '_big.pl'),
    Outcomes == 'none' ~ paste0(Cues, '_big.sg'),
    Outcomes == 'nem' ~ paste0(Cues, '_dim.sg'),
    Outcomes == 'shoon' ~ paste0(Cues, '_dim.sg')
  ))
```

## Interaction Sims
```{r}
plot_function_interaction = function(a1, a2, b1, b2, ap_setting) {


b2 = b2
a = a1
b = b1
a2 = a2

process_trace_cue = function(full_string, trace_outcome, b2, a1, b1, a2, ap_setting, data_df) {
  substrings = strsplit(full_string, "_")[[1]]
  
  #empty_dataframe = data.frame()
  result_list = map(substrings, function(cue) {
    out = RescorlaLogistic(
      data_df, 
      nruns = n,
      traceCue = cue,
      traceOutcome = trace_outcome, 
      beta2 = b2,
      alpha = a1,
      beta1 = b1,
      alpha2 = a2,
      ap = ap_setting
    )

    out_tibble = as_tibble_col(out$weightvector) %>%
      set_names(cue)
    
    
    return(out_tibble)
  }) 
    final_df = bind_cols(result_list) %>%
      mutate(totalweight = rowSums(across(where(is.numeric)), na.rm = T),
             traceCue_combined = full_string) %>%
      dplyr::select(totalweight, traceCue_combined) %>%
      mutate(Index = row_number())
    
  return(final_df)
}


results_familiar_stems_dan_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



results_familiar_stems_dan_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_familiar_stems_dan_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, a2 = a2, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



cx_dan_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
big_dan_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

pl_dan_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

#big_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

sg_nem_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_pl_dan_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b2, alpha=b, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + big_dan_cond1$weightvector + pl_dan_cond1$weightvector

dim_pl_dan_cond1 = dim_dan_cond1$weightvector + pl_dan_cond1$weightvector
dim_pl_nem_cond1 = dim_nem_cond1$weightvector + pl_nem_cond1$weightvector



dim_sg_nem_cond1 = RescorlaLogistic(data_cond1_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + dim_nem_cond1$weightvector + sg_nem_cond1$weightvector



cx_dan_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

pl_dan_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)


pl_nem_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)
sg_nem_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_sg_nem_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + dim_nem_cond2$weightvector + sg_nem_cond2$weightvector

big_pl_dan_cond2 = RescorlaLogistic(data_cond2_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + big_dan_cond2$weightvector + pl_dan_cond2$weightvector

dim_pl_dan_cond2 = dim_dan_cond2$weightvector + pl_dan_cond2$weightvector

dim_pl_nem_cond2 = dim_nem_cond2$weightvector + pl_nem_cond2$weightvector
  

cx_dan_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

pl_dan_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

big_dan_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)


pl_nem_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

sg_nem_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

dim_sg_nem_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + dim_nem_cond3$weightvector + sg_nem_cond3$weightvector

big_pl_dan_cond3 = RescorlaLogistic(data_cond3_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector + big_dan_cond3$weightvector + pl_dan_cond3$weightvector

dim_pl_dan_cond3 = dim_dan_cond3$weightvector + pl_dan_cond3$weightvector

dim_pl_nem_cond3 = dim_nem_cond3$weightvector + pl_nem_cond3$weightvector


cx_dan_cond1 = cx_dan_cond1$weightvector
cx_dan_cond2 = cx_dan_cond2$weightvector
cx_dan_cond3 = cx_dan_cond3$weightvector

cx_nem_cond1 = cx_nem_cond1$weightvector
cx_nem_cond2 = cx_nem_cond2$weightvector
cx_nem_cond3 = cx_nem_cond3$weightvector

familiar_big_pl_dan_cond1 = big_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1
familiar_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

novel_big_pl_dan_cond1 = big_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` + cx_dan_cond1 
novel_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

#familiar_big_pl_nem_cond1 = big_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
familiar_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
 
novel_big_pl_nem_cond1 = big_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)` #+ cx_nem_cond1


familiar_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1
novel_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  + cx_nem_cond1


#### Plot:

plot_familiar_big_pl_dan_cond1 = data.frame(weights = familiar_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond1 = data.frame(weights = familiar_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond1 = data.frame(weights = novel_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond1 = data.frame(weights = novel_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond1 = data.frame(weights = familiar_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond1 = data.frame(weights = familiar_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond1 = data.frame(weights = novel_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond1 = data.frame(weights = novel_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond1 = bind_rows(plot_familiar_big_pl_dan_cond1,
                              plot_familiar_dim_pl_dan_cond1,
                              plot_novel_big_pl_dan_cond1,
                              plot_novel_dim_pl_dan_cond1,
                              plot_familiar_dim_sg_nem_cond1,
                              plot_familiar_dim_pl_nem_cond1,
                              plot_novel_dim_sg_nem_cond1,
                              plot_novel_dim_pl_nem_cond1) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond1 = ggplot(plot_df_stems_all_cond1, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

#plot_df_stems_cond1



familiar_big_pl_dan_cond2 = big_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2
familiar_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 

novel_big_pl_dan_cond2 = big_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` + cx_dan_cond2 
novel_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 


familiar_big_pl_nem_cond2 = big_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)`   + cx_nem_cond2
familiar_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 

novel_big_pl_nem_cond2 = big_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 


familiar_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2
novel_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` + cx_nem_cond2


#### Plot:

plot_familiar_big_pl_dan_cond2 = data.frame(weights = familiar_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond2 = data.frame(weights = familiar_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond2 = data.frame(weights = novel_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond2 = data.frame(weights = novel_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond2 = data.frame(weights = familiar_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond2 = data.frame(weights = familiar_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond2 = data.frame(weights = novel_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond2 = data.frame(weights = novel_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond2 = bind_rows(plot_familiar_big_pl_dan_cond2,
                              plot_familiar_dim_pl_dan_cond2,
                              plot_novel_big_pl_dan_cond2,
                              plot_novel_dim_pl_dan_cond2,
                              plot_familiar_dim_sg_nem_cond2,
                              plot_familiar_dim_pl_nem_cond2,
                              plot_novel_dim_sg_nem_cond2,
                              plot_novel_dim_pl_nem_cond2) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond2 = ggplot(plot_df_stems_all_cond2, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


familiar_big_pl_dan_cond3 = big_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
familiar_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 

novel_big_pl_dan_cond3 = big_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` + cx_dan_cond3 
novel_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3  


familiar_big_pl_nem_cond3 = big_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
familiar_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3

novel_big_pl_nem_cond3 = big_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3 
novel_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


familiar_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3
novel_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` + cx_nem_cond3


#### Plot:

plot_familiar_big_pl_dan_cond3 = data.frame(weights = familiar_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond3 = data.frame(weights = familiar_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond3 = data.frame(weights = novel_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond3 = data.frame(weights = novel_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond3 = data.frame(weights = familiar_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond3 = data.frame(weights = familiar_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond3 = data.frame(weights = novel_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond3 = data.frame(weights = novel_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond3 = bind_rows(plot_familiar_big_pl_dan_cond3,
                              plot_familiar_dim_pl_dan_cond3,
                              plot_novel_big_pl_dan_cond3,
                              plot_novel_dim_pl_dan_cond3,
                              plot_familiar_dim_sg_nem_cond3,
                              plot_familiar_dim_pl_nem_cond3,
                              plot_novel_dim_sg_nem_cond3,
                              plot_novel_dim_pl_nem_cond3) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))


write_csv(plot_df_stems_all_cond1, '../Data/plot_df_stems_all_cond1.csv')
write_csv(plot_df_stems_all_cond2, '../Data/plot_df_stems_all_cond2.csv')
write_csv(plot_df_stems_all_cond3, '../Data/plot_df_stems_all_cond3.csv')

plot_df_stems_cond3 = ggplot(plot_df_stems_all_cond3, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type-Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

cond1_estimates = plot_df_stems_all_cond1 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type Frequency')


cond2_estimates = plot_df_stems_all_cond2 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Token Frequency')

cond3_estimates = plot_df_stems_all_cond3 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type-Token Frequency')


all_cond_estimates = rbind(cond1_estimates, cond2_estimates, cond3_estimates) %>%
  mutate(label = paste(Stem, Meaning))


all_cond_estimates = all_cond_estimates %>%
  mutate(freq = invlogit(Frequent),
         infreq = invlogit(Infrequent),
         freq_probs = freq / (freq + infreq)) %>%
  mutate(alpha = a1, beta = b1, beta2 = b2)
         

write_csv(all_cond_estimates, '../Data/all_cond_estimates.csv')
  
all_cond_estimates$Condition = factor(all_cond_estimates$Condition, levels = c('Type Frequency', 'Token Frequency', 'Type-Token Frequency'))



p1 = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_probs, fill = Meaning), position='dodge') +
  ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()


p1b = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_to_infreq, fill = Meaning), position='dodge') +
  #ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p1c = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = invlogit(Frequent - Infrequent), fill = Meaning), position='dodge') +
  #ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p2 = ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

tibble(p1 = list(p1), p1b = list(p1b), p1c = list(p1c), p2 = list(p2), all_cond_estimates = list(all_cond_estimates))

}

```

## Interaction sims results

```{r}
n = 1
run_inter = plot_function_interaction(a1 = 0.35, a2 = 0.1, b1 = 0.25, b2 = 0.1, ap_setting = F)

run_inter$p1b[[1]]
run_inter$p1c[[1]]
```


```{r}

alphas = seq(from = 0.1, to = 0.3, by = 0.1)
betas = seq(from = 0.1, to = 0.3, by = 0.1)
alpha2s = seq(from = 0.1, to = 0.3, by = 0.1)
beta2s = seq(from = 0.1, to = 0.3, by = 0.1)

df = expand.grid(alphas = alphas, alpha2s = alpha2s, betas = betas, beta2s = beta2s)# %>%
  #mutate(betas = alphas, beta2s = alpha2s)
#df = df %>% slice_head(n=2)

# sims_run = df %>%
#   mutate(plot_data = pmap(., ~ plot_function(..1, ..2, ..3, ..4, ap = T))) %>%
#   unnest_wider(plot_data)

sims_run2 = df %>%
  mutate(plot_data = pmap(., ~ plot_function_interaction(..1, ..2, ..3, ..4, ap = F))) %>%
  unnest_wider(plot_data)

sims_run2 = sims_run2 %>%
  mutate(p1b = map(p1b, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1b)) {
  ggsave(
    filename = paste0("../Plots/RW-Interaction/plot_p1_v2_", i, ".png"),
    plot = sims_run2$p1b[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}
```

```{r}
sims_run = sims_run %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Interaction/plot_p1_", i, ".png"),
    plot = sims_run$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

sims_run2 = sims_run2 %>%
  mutate(p1 = map(p1, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1)) {
  ggsave(
    filename = paste0("../Plots/RW-Interaction/plot_p1_v2_", i, ".png"),
    plot = sims_run2$p1[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}
```

## Interaction Sims Linear

```{r}

plot_function_interaction_linear = function(a1, a2, b1, b2, ap_setting) {
  #big_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2) #ap = T means you're learning something if the cue is absent 
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
#a1 = 0.1

process_trace_cue = function(full_string, trace_outcome, b2, a1, b1, ap_setting, data_df) {
  substrings = strsplit(full_string, "_")[[1]]
  
  #empty_dataframe = data.frame()
  result_list = map(substrings, function(cue) {
    out = RescorlaLinear(
      data_df, 
      nruns = n,
      traceCue = cue,
      traceOutcome = trace_outcome, 
      beta2 = b2,
      alpha = a1,
      beta1 = b1,
      ap = ap_setting
    )

    out_tibble = as_tibble_col(out$weightvector) %>%
      set_names(cue)
    
    
    return(out_tibble)
  }) 
    final_df = bind_cols(result_list) %>%
      mutate(totalweight = rowSums(across(where(is.numeric)), na.rm = T),
             traceCue_combined = full_string) %>%
      dplyr::select(totalweight, traceCue_combined) %>%
      mutate(Index = row_number())
    
  return(final_df)
}


results_familiar_stems_dan_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond1 = map_df(familiar_stems_cond1, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond1 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond1_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



results_familiar_stems_dan_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond2 = map_df(familiar_stems_cond2, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond2 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond2_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_familiar_stems_dan_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))


results_novel_stems_dan_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'dan', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_familiar_stems_nem_cond3 = map_df(familiar_stems_cond3, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))

results_novel_stems_nem_cond3 = map_df(novel_stems, .f = process_trace_cue, trace_outcome = 'nem', b2 = b2, a1 = a1, b1 = b1, ap_setting = ap_setting, data_df = data_cond3_interaction) %>%
  group_by(Index) %>%
  summarize(mean(totalweight))



cx_dan_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
  
#big_dan_cond1_test = RescorlaLogistic(data_cond1_test, nruns = n, traceCue='big', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

dim_dan_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_dan_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

#big_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='big', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
pl_nem_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

big_pl_dan_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector

dim_pl_dan_cond1 = dim_dan_cond1$weightvector + pl_dan_cond1$weightvector
dim_pl_nem_cond1 = dim_nem_cond1$weightvector + pl_nem_cond1$weightvector

dim_sg_nem_cond1 = RescorlaLinear(data_cond1_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector



cx_dan_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

pl_dan_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)

pl_nem_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)


dim_sg_nem_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector

big_pl_dan_cond2 = RescorlaLinear(data_cond2_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector

dim_pl_dan_cond2 = dim_dan_cond2$weightvector + pl_dan_cond2$weightvector

dim_pl_nem_cond2 = dim_nem_cond2$weightvector + pl_nem_cond2$weightvector
  

cx_dan_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='cx', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

cx_nem_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='cx', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

pl_dan_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_dan_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='dim', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_dan_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'dan', beta2=b, alpha=b, beta1=b, ap = F)


pl_nem_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)

dim_nem_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='dim', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)
#pl_nem_cond1 = RescorlaLogistic(data_cond1, nruns = n, traceCue='pl', traceOutcome = 'nem', beta2=b, alpha=b, beta1=b, ap = F)

dim_sg_nem_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='dim.sg', traceOutcome = 'nem', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector

big_pl_dan_cond3 = RescorlaLinear(data_cond3_interaction, nruns = n, traceCue='big.pl', traceOutcome = 'dan', beta2=b2, alpha=a, beta1=b, ap = ap_setting, lambda = lambda, alpha2 = a2)$weightvector
dim_pl_dan_cond3 = dim_dan_cond3$weightvector + pl_dan_cond3$weightvector

dim_pl_nem_cond3 = dim_nem_cond3$weightvector + pl_nem_cond3$weightvector


cx_dan_cond1 = cx_dan_cond1$weightvector
cx_dan_cond2 = cx_dan_cond2$weightvector
cx_dan_cond3 = cx_dan_cond3$weightvector

cx_nem_cond1 = cx_nem_cond1$weightvector
cx_nem_cond2 = cx_nem_cond2$weightvector
cx_nem_cond3 = cx_nem_cond3$weightvector

familiar_big_pl_dan_cond1 = big_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1
familiar_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_familiar_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

novel_big_pl_dan_cond1 = big_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1 
novel_dim_pl_dan_cond1 = dim_pl_dan_cond1 + results_novel_stems_dan_cond1$`mean(totalweight)` #+ cx_dan_cond1

familiar_big_pl_nem_cond1 = big_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
familiar_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
 
novel_big_pl_nem_cond1 = big_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
novel_dim_pl_nem_cond1 = dim_pl_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)` #+ cx_nem_cond1


familiar_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_familiar_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1
novel_dim_sg_nem_cond1 = dim_sg_nem_cond1 + results_novel_stems_nem_cond1$`mean(totalweight)`  #+ cx_nem_cond1


#### Plot:

plot_familiar_big_pl_dan_cond1 = data.frame(weights = familiar_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond1 = data.frame(weights = familiar_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond1 = data.frame(weights = novel_big_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond1 = data.frame(weights = novel_dim_pl_dan_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond1 = data.frame(weights = familiar_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond1 = data.frame(weights = familiar_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond1 = data.frame(weights = novel_dim_sg_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond1 = data.frame(weights = novel_dim_pl_nem_cond1) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond1 = bind_rows(plot_familiar_big_pl_dan_cond1,
                              plot_familiar_dim_pl_dan_cond1,
                              plot_novel_big_pl_dan_cond1,
                              plot_novel_dim_pl_dan_cond1,
                              plot_familiar_dim_sg_nem_cond1,
                              plot_familiar_dim_pl_nem_cond1,
                              plot_novel_dim_sg_nem_cond1,
                              plot_novel_dim_pl_nem_cond1) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond1 = ggplot(plot_df_stems_all_cond1, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()

#plot_df_stems_cond1



familiar_big_pl_dan_cond2 = big_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2
familiar_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_familiar_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 

novel_big_pl_dan_cond2 = big_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 
novel_dim_pl_dan_cond2 = dim_pl_dan_cond2 + results_novel_stems_dan_cond2$`mean(totalweight)` #+ cx_dan_cond2 


familiar_big_pl_nem_cond2 = big_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)`   #+ cx_nem_cond2
familiar_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 

novel_big_pl_nem_cond2 = big_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2
novel_dim_pl_nem_cond2 = dim_pl_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2 


familiar_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_familiar_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2
novel_dim_sg_nem_cond2 = dim_sg_nem_cond2 + results_novel_stems_nem_cond2$`mean(totalweight)` #+ cx_nem_cond2


#### Plot:

plot_familiar_big_pl_dan_cond2 = data.frame(weights = familiar_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond2 = data.frame(weights = familiar_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond2 = data.frame(weights = novel_big_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond2 = data.frame(weights = novel_dim_pl_dan_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond2 = data.frame(weights = familiar_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond2 = data.frame(weights = familiar_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond2 = data.frame(weights = novel_dim_sg_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond2 = data.frame(weights = novel_dim_pl_nem_cond2) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond2 = bind_rows(plot_familiar_big_pl_dan_cond2,
                              plot_familiar_dim_pl_dan_cond2,
                              plot_novel_big_pl_dan_cond2,
                              plot_novel_dim_pl_dan_cond2,
                              plot_familiar_dim_sg_nem_cond2,
                              plot_familiar_dim_pl_nem_cond2,
                              plot_novel_dim_sg_nem_cond2,
                              plot_novel_dim_pl_nem_cond2) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))

plot_df_stems_cond2 = ggplot(plot_df_stems_all_cond2, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


familiar_big_pl_dan_cond3 = big_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 
familiar_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_familiar_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 

novel_big_pl_dan_cond3 = big_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3 
novel_dim_pl_dan_cond3 = dim_pl_dan_cond3 + results_novel_stems_dan_cond3$`mean(totalweight)` #+ cx_dan_cond3  


familiar_big_pl_nem_cond3 = big_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3 
familiar_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3

novel_big_pl_nem_cond3 = big_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3 
novel_dim_pl_nem_cond3 = dim_pl_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


familiar_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_familiar_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3
novel_dim_sg_nem_cond3 = dim_sg_nem_cond3 + results_novel_stems_nem_cond3$`mean(totalweight)` #+ cx_nem_cond3


#### Plot:

plot_familiar_big_pl_dan_cond3 = data.frame(weights = familiar_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_familiar_dim_pl_dan_cond3 = data.frame(weights = familiar_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

plot_novel_big_pl_dan_cond3 = data.frame(weights = novel_big_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Frequent'
  )

plot_novel_dim_pl_dan_cond3 = data.frame(weights = novel_dim_pl_dan_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Frequent'
  )

## now with nem

plot_familiar_dim_sg_nem_cond3 = data.frame(weights = familiar_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_familiar_dim_pl_nem_cond3 = data.frame(weights = familiar_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Familiar',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )

plot_novel_dim_sg_nem_cond3 = data.frame(weights = novel_dim_sg_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Original',
    Frequency = 'Infrequent'
  )

plot_novel_dim_pl_nem_cond3 = data.frame(weights = novel_dim_pl_nem_cond3) %>%
  mutate(
    Stem = 'Novel',
    Meaning = 'Novel',
    Frequency = 'Infrequent'
  )





plot_df_stems_all_cond3 = bind_rows(plot_familiar_big_pl_dan_cond3,
                              plot_familiar_dim_pl_dan_cond3,
                              plot_novel_big_pl_dan_cond3,
                              plot_novel_dim_pl_dan_cond3,
                              plot_familiar_dim_sg_nem_cond3,
                              plot_familiar_dim_pl_nem_cond3,
                              plot_novel_dim_sg_nem_cond3,
                              plot_novel_dim_pl_nem_cond3) %>%
  group_by(Meaning, Stem, Frequency) %>%
  mutate(row_number = row_number()) %>%
  ungroup() %>%
  mutate(label = paste(Meaning, Frequency, sep = " "))


write_csv(plot_df_stems_all_cond1, '../Data/plot_df_stems_all_cond1.csv')
write_csv(plot_df_stems_all_cond2, '../Data/plot_df_stems_all_cond2.csv')
write_csv(plot_df_stems_all_cond3, '../Data/plot_df_stems_all_cond3.csv')

plot_df_stems_cond3 = ggplot(plot_df_stems_all_cond3, aes(x = row_number, y = weights, color = label)) +
  geom_line() +
  labs(
    x = "Index",
    y = "Activation Weight",
    color = "Meaning and Frequency",
    title = "Type-Token Frequency Condition"
  ) +
  #ylim(-2,4) +
  facet_wrap(~Stem) +
  theme_minimal()


ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

cond1_estimates = plot_df_stems_all_cond1 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type Frequency')


cond2_estimates = plot_df_stems_all_cond2 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Token Frequency')

cond3_estimates = plot_df_stems_all_cond3 %>%
  group_by(Stem, Meaning, Frequency) %>%
  slice_tail(n=1) %>%
  ungroup() %>%
  dplyr::select(Stem, Meaning, Frequency, weights) %>%
  group_by(Stem, Meaning) %>%
  pivot_wider(names_from = Frequency, values_from = weights) %>%
  mutate(freq_to_infreq = Frequent - Infrequent) %>%
  mutate(Condition = 'Type-Token Frequency')


all_cond_estimates = rbind(cond1_estimates, cond2_estimates, cond3_estimates) %>%
  mutate(label = paste(Stem, Meaning))


all_cond_estimates = all_cond_estimates %>%
  mutate(freq = Frequent,
         infreq = Infrequent,
         freq_probs = freq / (freq + infreq))
         

write_csv(all_cond_estimates, '../Data/all_cond_estimates.csv')
  
all_cond_estimates$Condition = factor(all_cond_estimates$Condition, levels = c('Type Frequency', 'Token Frequency', 'Type-Token Frequency'))



p1 = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_probs, fill = Meaning), position='dodge') +
  ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p1b = ggplot(data = all_cond_estimates) +
  geom_col(aes(x = Condition, y = freq_to_infreq, fill = Meaning), position='dodge') +
  #ylim(0,1) + 
  facet_wrap(~Stem) +
  theme_bw()

p2 = ggarrange(plot_df_stems_cond1, plot_df_stems_cond2, plot_df_stems_cond3, common.legend = T)

tibble(p1 = list(p1), p1b = list(p1b), p2 = list(p2), list(all_cond_estimates))

}

```


## interaction sims linear results

```{r}
plot_function_interaction_linear(a1 = 0.2, a2 = 0.1, b1 = 0.3, b2 = 0.1, ap_setting = F)$p1b[[1]]
```


```{r}

alphas = seq(from = 0.1, to = 0.3, by = 0.1)
betas = seq(from = 0.1, to = 0.3, by = 0.1)
alpha2s = seq(from = 0.1, to = 0.3, by = 0.1)
beta2s = seq(from = 0.1, to = 0.3, by = 0.1)

#alphas = seq(from = 0, to = 1, by = 0.2)
#alpha2s = alphas

df = expand.grid(alphas = alphas, alpha2s = alpha2s, betas = betas, beta2s = beta2s)
#df = df %>% slice_head(n=2)

test = plot_function_interaction_linear(0.2, 0.1, 0.2, 0.1, ap = F)
test$p1b

sims_run2 = df %>%
  mutate(plot_data = pmap(., ~ plot_function_interaction_linear(..1, ..2, ..3, ..4, ap = F))) %>%
  unnest_wider(plot_data)


df_test = data.frame(alphas = rep(0.2, times = 20), alpha2s = rep(0.1, times = 20), betas = rep(0.1, times = 20), beta2s = rep(0.1, times = 20))

  


sims_run3 = df_test %>%
 mutate(plot_data = pmap(., ~ plot_function_interaction_linear(..1, ..2, ..3, ..4, ap = F))) %>%
 unnest_wider(plot_data)

sims_run4 = df_test %>%
 mutate(plot_data = pmap(., ~ plot_function_linear(..1, ..2, ..3, ..4, ap = F))) %>%
 unnest_wider(plot_data)

sims_run4[4,]$p1b

for_paper = sims_run3[12,]
for_paper_all_cond_csv = sims_run3$`list(all_cond_estimates)`[[1]]
for_paper_all_cond_csv = for_paper_all_cond_csv[[1]]

write_csv(for_paper_all_cond_csv, '../Data/for_paper_all_cond_csv.csv')

sims_run2 = sims_run2 %>%
  mutate(p1b = map(p1b, ~ .x[[1]]))

for (i in seq_along(sims_run2$p1b)) {
  ggsave(
    filename = paste0("../Plots/RW-Interaction/plot_p1_v1b_", i, ".png"),
    plot = sims_run2$p1b[[i]],
    width = 6,
    height = 4,
    dpi = 300
  )
}

# sims_run2 = sims_run2 %>%
#   mutate(p1 = map(p1, ~ .x[[1]]))
# 
# for (i in seq_along(sims_run2$p1)) {
#   ggsave(
#     filename = paste0("../Plots/RW-Interaction/plot_p1_v1_", i, ".png"),
#     plot = sims_run2$p1[[i]],
#     width = 6,
#     height = 4,
#     dpi = 300
#   )
# }

# 
# sims_run = df %>%
#   mutate(plot_data = pmap(., ~ plot_function_interaction_linear(..1, ..2, ..3, ..4, ap = T))) %>%
#   unnest_wider(plot_data)
# 
# sims_run = sims_run %>%
#   mutate(p1 = map(p1, ~ .x[[1]]))
# 
# for (i in seq_along(sims_run$p1)) {
#   ggsave(
#     filename = paste0("../Plots/RW-Interaction/plot_p1_v2_", i, ".png"),
#     plot = sims_run$p1[[i]],
#     width = 6,
#     height = 4,
#     dpi = 300
#   )
# }
# 
# sims_run = sims_run %>%
#   mutate(p1b = map(p1b, ~ .x[[1]]))
# 
# for (i in seq_along(sims_run$p1b)) {
#   ggsave(
#     filename = paste0("../Plots/RW-Interaction/plot_p1_v2b", i, ".png"),
#     plot = sims_run$p1b[[i]],
#     width = 6,
#     height = 4,
#     dpi = 300
#   )
# }

```