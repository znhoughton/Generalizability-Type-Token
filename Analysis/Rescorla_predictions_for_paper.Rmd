---
title: "Rescorla_predictions3"
author: "Zachary Houghton"
date: "2025-05-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Rescorla Predictions

Libraries:

```{r}
library(tidyverse)
library(brms)
library(ggpubr)
library(ggh4x)
library(arm)
library(ndl)
#logistic perceptron from neural net
source("RescorlaLogistic.R")
```

## Condition 1 (dan type): 12 token, 12 type (nem 12 tokens 3 types)


```{r}
cond1 = read_csv('../Conditions/Condition1.csv') 

cond1 = cond1 %>%
  mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond1 = cond1 %>%
  mutate(key = paste0(stem, '_', type))

cond1_key = cond1 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond1_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond1 = cond1_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5) #%>% 
  #mutate(Cues = paste0("cx_", Cues))

data_cond1 = data_cond1 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)

```

## Condition 2 (dan token): 12 tokens, 3 types

```{r}

cond2 = read_csv('../Conditions/Condition2.csv') 
cond2 = cond2 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond2 = cond2 %>%
  mutate(key = paste0(stem, '_', type))

cond2_key = cond2 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond2_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond2 = cond2_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5)# %>% 
  #mutate(Cues = paste0("cx_", Cues))

data_cond2 = data_cond2 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)
```

## Condition 3 (dan type and token): 12 tokens, 12 types (nem 3 tokens, 3 types)

```{r}

cond3 = read_csv('../Conditions/Condition3.csv') 
cond3 = cond3 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond3 = cond3 %>%
  mutate(key = paste0(stem, '_', type))

cond3_key = cond3 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond3_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond3 = cond3_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5)# %>% 
  #mutate(Cues = paste0("cx_", Cues))


data_cond3 = data_cond3 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)
```


## Condition 4 (nem type): 12 token, 12 type (dan 12 token, 3 type)

```{r}

cond4 = read_csv('../Conditions/Condition4.csv') 
cond4 = cond4 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond4 = cond4 %>%
  mutate(key = paste0(stem, '_', type))

cond4_key = cond4 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond4_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond4 = cond4_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5) 

data_cond4 = data_cond4 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)
```



## Condition 5 (nem token): 12 token, 3 types (dan 3 token, 3 type)

```{r}

cond5 = read_csv('../Conditions/Condition5.csv') 
cond5 = cond5 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  

cond5 = cond5 %>%
  mutate(key = paste0(stem, '_', type))

cond5_key = cond5 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond5_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond5 = cond5_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5)

data_cond5 = data_cond5 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)
```



## Condition 6: (nem type and token) 12 token 12 type (dan 3 token 3 type)

```{r}

cond6 = read_csv('../Conditions/Condition6.csv') 
cond6 = cond6 %>%
    mutate(stem = orthoCoding(stem)) %>%
  mutate(type = case_when(
    suffix == 'dan' | suffix == 'sil' ~ 'big_pl',
    suffix == 'none' ~ 'big_sg',
    suffix == 'nem' | suffix == 'shoon' ~ 'dim_sg'
  ))
  
cond6 = cond6 %>%
  mutate(key = paste0(stem, '_', type))

cond6_key = cond6 %>%
  group_by(key, suffix) %>%
  summarize(frequency = table(key))

colnames(cond6_key) = c('Cues', 'Outcomes', 'Frequency')

data_cond6 = cond6_key %>%
  mutate(Frequency = as.numeric(Frequency) * 5)

data_cond6 = data_cond6 %>%
  uncount(Frequency) %>%
  mutate(Frequency = 1)
```


## Rescorla function

```{r}
n_sims = 1

data_cond1_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond1[sample(1:nrow(data_cond1)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond2[sample(1:nrow(data_cond2)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond3[sample(1:nrow(data_cond3)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond4[sample(1:nrow(data_cond4)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond5[sample(1:nrow(data_cond5)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond6[sample(1:nrow(data_cond6)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_all_conds = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_logistic = data_all_conds
  
```
## comparing with human data

```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds = data_all_conds %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)

data_all_conds = data_all_conds %>%
  mutate(freq_minus_infreq = dv)



data_all_conds_for_comparison = data_all_conds %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, freq_minus_infreq, dan_activations, nem_activations, sil_activations, shoon_activations)

human_data_no_sil_no_shoon_plus_rw_preds = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison)

  
```

## Plotting
```{r}

data_prod_cond1_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1_for_plotting = data_prod_cond1_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1_for_plotting = data_prod_cond1_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond1_for_plotting = data_prod_results_cond1_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond1_for_plotting = data_prod_results_cond1_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)

## c2

data_prod_cond2_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2_for_plotting = data_prod_cond2_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2_for_plotting = data_prod_cond2_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond2_for_plotting = data_prod_results_cond2_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond2_for_plotting = data_prod_results_cond2_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)

## c3

data_prod_cond3_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3_for_plotting = data_prod_cond3_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3_for_plotting = data_prod_cond3_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond3_for_plotting = data_prod_results_cond3_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond3_for_plotting = data_prod_results_cond3_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)

# 
# data_prod_results_cond1_for_plotting = data_prod_results_cond1_for_plotting %>%
#   group_by(type, prod_condition, is.stem) %>%
#   summarize(mean(freq_minus_infreq)) %>%
#   mutate(condition = 1)
# 
# data_prod_results_cond2_for_plotting =data_prod_results_cond2_for_plotting %>%
#   group_by(type, prod_condition, is.stem) %>%
#   summarize(mean(freq_minus_infreq)) %>%
#   mutate(condition = 2)
# 
# data_prod_results_cond3_for_plotting = data_prod_results_cond3_for_plotting %>%
#   group_by(type, prod_condition, is.stem) %>%
#   summarize(mean(freq_minus_infreq)) %>%
#   mutate(condition = 3)
# 
# data_prod_results_for_plotting = rbind(
#   data_prod_results_cond1_for_plotting,
#   data_prod_results_cond2_for_plotting,
#   data_prod_results_cond3_for_plotting
# )




## c4

data_prod_cond4_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4_for_plotting = data_prod_cond4_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4_for_plotting = data_prod_cond4_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond4_for_plotting = data_prod_results_cond4_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond4_for_plotting = data_prod_results_cond4_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




## c5

data_prod_cond5_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5_for_plotting = data_prod_cond5_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5_for_plotting = data_prod_cond5_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond5_for_plotting = data_prod_results_cond5_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond5_for_plotting = data_prod_results_cond5_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)


## c6

data_prod_cond6_for_plotting = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6_for_plotting = data_prod_cond6_for_plotting %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6_for_plotting = data_prod_cond6_for_plotting %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix, by = c("key" = "cue"))

data_prod_results_cond6_for_plotting = data_prod_results_cond6_for_plotting %>%
  mutate(is.stem = case_when(
    key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
    .default = 1
  ))


data_prod_results_cond6_for_plotting = data_prod_results_cond6_for_plotting %>%
  group_by(row_id, is.stem) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)




data_prod_results_cond1_for_plotting = data_prod_results_cond1_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond2_for_plotting = data_prod_results_cond2_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond3_for_plotting = data_prod_results_cond3_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond4_for_plotting = data_prod_results_cond4_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond5_for_plotting = data_prod_results_cond5_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond6_for_plotting = data_prod_results_cond6_for_plotting %>%
  group_by(prod_label, is.stem) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')



data_prod_results_for_stem_plot = rbind(
  data_prod_results_cond1_for_plotting,
  data_prod_results_cond2_for_plotting,
  data_prod_results_cond3_for_plotting,
  data_prod_results_cond4_for_plotting,
  data_prod_results_cond5_for_plotting,
  data_prod_results_cond6_for_plotting
)

data_prod_results_for_stem_plot$freq_minus_infreq = data_prod_results_for_stem_plot$dv

data_prod_results_cond1_for_plotting = data_prod_results_cond1_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'infrequent'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 1)

data_prod_results_cond2_for_plotting = data_prod_results_cond2_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'infrequent'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 2)

data_prod_results_cond3_for_plotting = data_prod_results_cond3_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'infrequent'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 3)

data_prod_results_cond4_for_plotting = data_prod_results_cond4_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'infrequent',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'original'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 4)

data_prod_results_cond5_for_plotting = data_prod_results_cond5_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'infrequent',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'original'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 5)

data_prod_results_cond6_for_plotting = data_prod_results_cond6_for_plotting %>%
  mutate(meaning = case_when(
    type == 'big_pl' ~ 'infrequent',
    type == 'dim_pl' ~ 'novel',
    type == 'dim_sg' ~ 'original'
  )) %>%
  group_by(meaning, prod_condition, is.stem) %>%
  summarize(mean(freq_minus_infreq)) %>%
  mutate(condition = 6)

data_prod_results_for_plotting = rbind(
  data_prod_results_cond1_for_plotting,
  data_prod_results_cond2_for_plotting,
  data_prod_results_cond3_for_plotting,
  data_prod_results_cond4_for_plotting,
  data_prod_results_cond5_for_plotting,
  data_prod_results_cond6_for_plotting
)
# 
# library(ggh4x)
# ggplot(data = data_prod_results_for_plotting, aes(x = factor(is.stem), y = `mean(freq_minus_infreq)`, fill = prod_condition)) +
#   geom_col(position = "dodge") +
#   facet_nested(meaning~condition)


```
## RW Logistic Statistical Models

```{r}
options(contrasts = c("contr.treatment","contr.treatment"))

priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))

model_human_rw_preds = brm(frequency ~ freq_minus_infreq + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 15000, 
                                       warmup = 7500,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       #control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_rw_preds')


data_prod_results_for_plotting_stem_suffix_vary = data_prod_results_for_stem_plot %>%
  dplyr::select(-dan_activations, -sil_activations, -nem_activations, -shoon_activations, -dv) %>%
  ungroup() %>%
  mutate(label = ifelse(is.stem == 1, 'stem', 'suffix')) %>%
  dplyr::select(-is.stem) %>%
  pivot_wider(
    names_from = label,
    values_from = freq_minus_infreq,
    names_glue = 'freq_minus_infreq_{label}') %>%
  rename('stem_condition' = prod_condition) %>%
  rename('picture_meaning' = type) %>%
  rename('original_condition' = condition) %>%
  rename('resp_stem' = prod_label)

human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary = human_data_no_sil_no_shoon %>%
  left_join(data_prod_results_for_plotting_stem_suffix_vary)


model_prod_rw_stem_suffix_vary = brm(frequency ~ freq_minus_infreq_stem + freq_minus_infreq_suffix + (1 | participant) + (1 | resp_stem), #resp_stem intercept removed because it's redundant with freq_minus_infreq_stem
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_rw_stem_suffix_vary')


# model_prod_rw_stem_suffix_vary_match_human_model = brm(frequency ~ freq_minus_infreq_stem * freq_minus_infreq_suffix * condition * meaning * stem_condition + (1 | participant) + (1 | resp_stem), #resp_stem intercept removed because it's redundant with freq_minus_infreq_stem
#                                        data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
#                                        family = bernoulli(link = 'logit'),
#                                        iter = 14000, 
#                                        warmup = 7000,
#                                        chains = 4,
#                                        cores = 4,
#                                        prior = priors_m1,
#                                        control = list(adapt_delta = 0.99),
#                                        save_pars = save_pars(all = TRUE),
#                                        file = '../Data/model_prod_rw_stem_suffix_vary_match_human_model')


human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$condition = factor(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$condition, levels = c(3, 1, 2))



model_prod_rw_stem_suffix_vary_by_condition = brm(frequency ~ freq_minus_infreq_stem + freq_minus_infreq_suffix + condition + freq_minus_infreq_stem:condition + freq_minus_infreq_suffix:condition + (1 | participant) + (1 | resp_stem), #resp_stem intercept removed because it's redundant with freq_minus_infreq_stem
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_rw_stem_suffix_vary_by_condition')


human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$meaning = factor(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$meaning)

contrasts(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$meaning) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$meaning))

human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$stem_condition = factor(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$stem_condition, levels = c('novel', 'familiar'))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$stem_condition) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$stem_condition))


model_prod_rw_stem_suffix_vary_by_condition_original_preds = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq_stem + freq_minus_infreq_suffix + freq_minus_infreq_stem:condition + freq_minus_infreq_suffix:condition + (1 | participant) + (1 | resp_stem), #resp_stem intercept removed because it's redundant with freq_minus_infreq_stem
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_rw_stem_suffix_vary_by_condition_original_preds')


# model_prod_rw_stem_suffix_vary_by_condition = brm(frequency ~ freq_minus_infreq_stem * freq_minus_infreq_suffix * condition + (1 + freq_minus_infreq_stem * freq_minus_infreq_suffix | participant),
#                                        data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
#                                        family = bernoulli(link = 'logit'),
#                                        iter = 14000, 
#                                        warmup = 7000,
#                                        chains = 4,
#                                        cores = 4,
#                                        prior = priors_m1,
#                                        control = list(adapt_delta = 0.99),
#                                        save_pars = save_pars(all = TRUE),
#                                        file = '../Data/model_prod_rw_stem_suffix_vary_by_condition')



fixef(model_prod_rw_stem_suffix_vary)

#model_prod_rw_stem_suffix_vary$criteria$loo = NULL
model_prod_rw_stem_suffix_vary_by_condition = add_criterion(model_prod_rw_stem_suffix_vary_by_condition, 'loo')
model_prod_rw_stem_suffix_vary = add_criterion(model_prod_rw_stem_suffix_vary, 'loo')
model_prod_rw_stem_suffix_vary_by_condition_original_preds = add_criterion(model_prod_rw_stem_suffix_vary_by_condition_original_preds, 'loo')
```

```{r}
options(contrasts = c("contr.treatment","contr.treatment"))
human_data_no_sil_no_shoon_plus_rw_preds$meaning = factor(human_data_no_sil_no_shoon_plus_rw_preds$meaning)
human_data_no_sil_no_shoon_plus_rw_preds$condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$condition, levels = c(3, 1, 2))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds$meaning) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$meaning))

human_data_no_sil_no_shoon_plus_rw_preds$stem_condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition, levels = c('novel', 'familiar'))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition))


priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))


model_prod_both_stem_rw_simple = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_rw_simple')

model_prod_both_stem_rw = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq + (1 + condition*meaning*stem_condition | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_rw_preds_final')

model_prod_both_stem_simple_humans = brm(frequency ~ condition*meaning*stem_condition + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_simple_humans')


model_prod_both_stem_rw_suffix_stem_vary = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq_stem * freq_minus_infreq_suffix + (1 + freq_minus_infreq_stem * freq_minus_infreq_suffix | participant),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_rw_suffix_stem_vary')


fixef(model_prod_both_stem_rw)
#conditional_effects(model_prod_both_stem_rw)

# model_human_rw_preds$criteria$loo = NULL
# model_prod_both_stem_rw$criteria$loo = NULL
# model_prod_both_stem_rw_simple$criteria$loo = NULL
# model_prod_both_stem_simple_humans$criteria$loo = NULL

model_human_rw_preds = add_criterion(model_human_rw_preds, 'loo')
model_prod_both_stem_rw = add_criterion(model_prod_both_stem_rw, 'loo')
model_prod_both_stem_rw_simple = add_criterion(model_prod_both_stem_rw_simple, 'loo')
model_prod_both_stem_simple_humans = add_criterion(model_prod_both_stem_simple_humans, 'loo')

#want to compare the model with only freq_minus_infreq (model_human_rw_preds) to the simple model (model_prod_both_stem_rw_simple) and model_prod_both_stem_rw

#model_prod_both_stems = add_criterion(model_prod_both_stems, 'loo')
model_prod_both_stem_rw_suffix_stem_vary = add_criterion(model_prod_both_stem_rw_suffix_stem_vary, 'loo')

#model_prod_both_stems = add_criterion(model_prod_both_stems, 'loo')

loo_compare(model_human_rw_preds, model_prod_rw_stem_suffix_vary, model_prod_both_stem_rw_simple, model_prod_both_stem_simple_humans, model_prod_both_stem_rw_suffix_stem_vary)

#loo_comparisons = data.frame(loo_compare(model_human_rw_preds, model_prod_rw_stem_suffix_vary, model_prod_both_stem_rw_simple, model_prod_both_stem_simple_humans))

#loo_comparisons = 

# loo_compare(model_human_rw_preds, model_human_rw_preds_linear, model_prod_both_stem_rw_simple, model_prod_both_stem_rw_linear_simple, model_prod_both_stem_simple_humans)

```

```{r}
human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary_cond2 = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary %>%
  filter(condition == 2)
# 
# 
# model_prod_rw_stem_suffix_vary_cond2 = brm(frequency ~ freq_minus_infreq_stem * freq_minus_infreq_suffix,
#                                        data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
#                                        family = bernoulli(link = 'logit'),
#                                        iter = 6000, 
#                                        warmup = 3000,
#                                        chains = 4,
#                                        cores = 4,
#                                        #prior = priors_m1,
#                                        #control = list(adapt_delta = 0.99),
#                                        save_pars = save_pars(all = TRUE)) #,
                                       #file = '../Data/model_prod_rw_stem_suffix_vary_cond2')
```


## Linear model



```{r}
n_sims = 1

data_cond1_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond1[sample(1:nrow(data_cond1)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond2[sample(1:nrow(data_cond2)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond3[sample(1:nrow(data_cond3)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond4[sample(1:nrow(data_cond4)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond5[sample(1:nrow(data_cond5)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond6[sample(1:nrow(data_cond6)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)



data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  ))# %>%
  #filter(type != 'big_pl')




data_all_conds = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )
  
```
## comparing with human data

```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds = data_all_conds %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)


data_all_conds_for_comparison = data_all_conds %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, dv, dan_activations, nem_activations, sil_activations, shoon_activations)

human_data_no_sil_no_shoon_plus_rw_preds = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison)
  
```
```{r}


human_data_no_sil_no_shoon_plus_rw_preds = human_data_no_sil_no_shoon_plus_rw_preds %>%
  mutate(freq_minus_infreq = dv)


model_human_rw_preds_linear = brm(frequency ~ freq_minus_infreq + (freq_minus_infreq | participant) + (1|resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 16000, 
                                       warmup = 8000,
                                       chains = 4,
                                       cores = 4,
                                       #prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       file = '../Data/model_human_rw_preds_linear')

fixef(model_human_rw_preds_linear)

model_human_rw_preds_linear = add_criterion(model_human_rw_preds_linear, 'loo')

```

```{r}
options(contrasts = c("contr.treatment","contr.treatment"))
human_data_no_sil_no_shoon_plus_rw_preds$meaning = factor(human_data_no_sil_no_shoon_plus_rw_preds$meaning)
human_data_no_sil_no_shoon_plus_rw_preds$condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$condition, levels = c(3, 1, 2))
contrasts(human_data_no_sil_no_shoon_plus_rw_preds$meaning) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$meaning))

human_data_no_sil_no_shoon_plus_rw_preds$stem_condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition, levels = c('novel', 'familiar'))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition))


priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))


model_prod_both_stem_rw_linear_simple = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq + (1 + freq_minus_infreq | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_rw_linear_simple')


model_prod_both_stem_rw_linear = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq + (1 + meaning*stem_condition + freq_minus_infreq | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_rw_linear')


fixef(model_prod_both_stem_rw_linear_simple)
```

```{r}
percent_greater_zero_rw = data.frame(fixef(model_prod_both_stem_rw, summary = F)) %>%
  pivot_longer(cols = everything(), names_to = 'beta_coefficient', values_to = 'estimate') %>%
  group_by(beta_coefficient) %>%
  summarize((sum(estimate > 0) / length(estimate)) * 100)

percent_greater_zero_rw_linear = data.frame(fixef(model_prod_both_stem_rw_linear_simple, summary = F)) %>%
  pivot_longer(cols = everything(), names_to = 'beta_coefficient', values_to = 'estimate') %>%
  group_by(beta_coefficient) %>%
  summarize((sum(estimate > 0) / length(estimate)) * 100)

percent_greater_zero_rw

percent_greater_zero_rw_linear
```

## Model Comparison

```{r}
#model_prod_both_stem_rw$criteria$loo = NULL
#model_prod_both_stem_rw_linear_simple$criteria$loo = NULL
model_prod_both_stem_rw_linear = add_criterion(model_prod_both_stem_rw_linear, 'loo')

model_prod_both_stem_rw_linear_simple = add_criterion(model_prod_both_stem_rw_linear_simple, 'loo')

#loo1 = loo(model_prod_both_stem_rw, moment_match = TRUE, cores = 4, recompile = T)

#loo2 = loo(model_prod_both_stem_rw_linear, moment_match = TRUE, cores = 4)

loo_compare(model_human_rw_preds, model_human_rw_preds_linear, model_prod_both_stem_rw_simple, model_prod_both_stem_rw_linear_simple, model_prod_both_stem_simple_humans)


loo_compare(model_human_rw_preds, model_prod_both_stem_rw, model_prod_both_stem_rw_simple, model_human_rw_preds_linear, model_prod_both_stem_rw_linear, model_prod_both_stem_rw_linear_simple)
#lower elpd is better, so 
```
## Observed vs expected plots

```{r}

data_all_conds_logistic2 = data_all_conds_logistic %>%
  mutate(meaning = case_when(
    type == 'dim_sg' | type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(dv), test = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot = ggplot(data = data_all_conds_logistic2, aes(x = meaning, y = invlogit(mean_freq_diff), fill = prod_condition)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  facet_wrap(~condition)


#observed estimates:
fixed_effects_df = read_csv('../Data/fixed_effects_df_all.csv') %>%
  filter(Task == 'prod')

observed_estimates = fixed_effects_df 


observed_estimates_plot = ggplot(data = observed_estimates, aes(x = Meaning, y = Prob, fill = Stem)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  facet_wrap(~Condition)


rw_plot
observed_estimates_plot

ggarrange(observed_estimates_plot, rw_plot, nrow = 2, common.legend = T)
```


## Bush-Mosteller

```{r}
n_sims = 1

data_cond1_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond1[sample(1:nrow(data_cond1)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond2[sample(1:nrow(data_cond2)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond3[sample(1:nrow(data_cond3)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond4[sample(1:nrow(data_cond4)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond5[sample(1:nrow(data_cond5)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(BushMosteller(cuesOutcomes = data_cond6[sample(1:nrow(data_cond6)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)



data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) #%>%
  #filter(type != 'big_pl')




data_all_conds = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_logistic = data_all_conds
  
```
## comparing with human data

```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds = data_all_conds %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)

data_all_conds %>%
  mutate(freq_minus_infreq = dv)

data_all_conds_for_comparison = data_all_conds %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, freq_minus_infreq, dan_activations, nem_activations, sil_activations, shoon_activations)

human_data_no_sil_no_shoon_plus_rw_preds = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison)
  
```

## Statistical Models

```{r}

priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))

model_human_bm_preds = brm(frequency ~ freq_minus_infreq + (freq_minus_infreq | participant) + (1|resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 15000, 
                                       warmup = 7500,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       #control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_bm_preds')

# 
# data_prod_results_for_plotting_stem_suffix_vary = data_prod_results_for_stem_plot %>%
#   dplyr::select(-dan_activations, -sil_activations, -nem_activations, -shoon_activations) %>%
#   ungroup() %>%
#   mutate(label = ifelse(is.stem == 1, 'stem', 'suffix')) %>%
#   dplyr::select(-is.stem) %>%
#   pivot_wider(
#     names_from = label,
#     values_from = freq_minus_infreq,
#     names_glue = 'freq_minus_infreq_{label}') %>%
#   rename('stem_condition' = prod_condition) %>%
#   rename('picture_meaning' = type) %>%
#   rename('original_condition' = condition) %>%
#   rename('resp_stem' = prod_label)

human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary = human_data_no_sil_no_shoon %>%
  left_join(data_prod_results_for_plotting_stem_suffix_vary)


model_prod_bm_stem_suffix_vary = brm(frequency ~ freq_minus_infreq_stem * freq_minus_infreq_suffix + (1 + freq_minus_infreq_stem * freq_minus_infreq_suffix | participant), #resp_stem intercept removed because it's redundant with freq_minus_infreq_stem
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_bm_stem_suffix_vary')

human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$condition = factor(human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary$condition, levels = c(3, 1, 2))



fixef(model_prod_bm_stem_suffix_vary)

#model_prod_rw_stem_suffix_vary$criteria$loo = NULL
model_prod_bm_stem_suffix_vary = add_criterion(model_prod_bm_stem_suffix_vary, 'loo')
model_human_bm_preds = add_criterion(model_human_bm_preds, 'loo')
```

```{r}
options(contrasts = c("contr.treatment","contr.treatment"))
human_data_no_sil_no_shoon_plus_rw_preds$meaning = factor(human_data_no_sil_no_shoon_plus_rw_preds$meaning)
human_data_no_sil_no_shoon_plus_rw_preds$condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$condition, levels = c(3, 1, 2))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds$meaning) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$meaning))

human_data_no_sil_no_shoon_plus_rw_preds$stem_condition = factor(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition, levels = c('novel', 'familiar'))

contrasts(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition) = contr.sum(levels(human_data_no_sil_no_shoon_plus_rw_preds$stem_condition))


priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))


model_prod_both_stem_bm_simple = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq + (1 + freq_minus_infreq | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_bm_simple')



model_prod_both_stem_bm_suffix_stem_vary = brm(frequency ~ condition*meaning*stem_condition + freq_minus_infreq_stem * freq_minus_infreq_suffix + (1 + freq_minus_infreq_stem * freq_minus_infreq_suffix | participant),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_stem_suffix_vary,
                                       family = bernoulli(link = 'logit'),
                                       iter = 14000, 
                                       warmup = 7000,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_prod_both_stem_bm_suffix_stem_vary')

model_prod_both_stem_bm_simple = add_criterion(model_prod_both_stem_bm_simple, 'loo')
model_prod_both_stem_bm_suffix_stem_vary = add_criterion(model_prod_both_stem_bm_suffix_stem_vary, 'loo')

```

## Loo compare

```{r}
loo_comparisons = data.frame(loo_compare(model_human_rw_preds, model_prod_rw_stem_suffix_vary, model_prod_both_stem_rw_simple, model_prod_both_stem_simple_humans, model_prod_bm_stem_suffix_vary, model_human_bm_preds, model_prod_both_stem_bm_simple, model_prod_both_stem_bm_suffix_stem_vary, model_prod_both_stem_rw_suffix_stem_vary))
```


## Configural Cues and Modified Alpha 

### Configural cues only

```{r}

data_cond1_configural = data_cond1 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond2_configural = data_cond2 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond3_configural = data_cond3 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond4_configural = data_cond4 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond5_configural = data_cond5 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond6_configural = data_cond6 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

n_sims = 1

data_cond1_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond1_configural[sample(1:nrow(data_cond1_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond2_configural[sample(1:nrow(data_cond2_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond3_configural[sample(1:nrow(data_cond3_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond4_configural[sample(1:nrow(data_cond4_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond5_configural[sample(1:nrow(data_cond5_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond6_configural[sample(1:nrow(data_cond6_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod = data_prod %>%
  mutate(type = case_when(
    type == 'dim_sg' ~ 'dim_sg_dim.sg',
    type == 'big_pl' ~ 'big_pl_big.pl',
    type == 'dim_pl' ~ 'dim_pl'
  ))

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)


#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix_configural, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_all_conds_configural = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_logistic_configural = data_all_conds_configural
  
```
```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds_conf = data_all_conds_configural %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)

data_all_conds_conf %>%
  mutate(freq_minus_infreq = dv)

data_all_conds_for_comparison_conf = data_all_conds_conf %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, freq_minus_infreq, dan_activations, nem_activations, sil_activations, shoon_activations)

data_all_conds_for_comparison_conf = data_all_conds_for_comparison_conf %>%
  mutate(picture_meaning = case_when(
    picture_meaning == 'dim_sg_dim.sg' ~ 'dim_sg',
    picture_meaning == 'big_pl_big.pl' ~ 'big_pl',
    .default = picture_meaning
  ))

human_data_no_sil_no_shoon_plus_rw_preds_conf = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison_conf)
  
```

####  Models
```{r}
priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))

model_human_conf = brm(frequency ~ freq_minus_infreq + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_conf,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_conf')


model_human_conf = add_criterion(model_human_conf, 'loo')

model_human_conf_original_preds = brm(frequency ~ freq_minus_infreq + condition*meaning*stem_condition + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_conf,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_conf_original_preds')


model_human_conf_original_preds = add_criterion(model_human_conf_original_preds, 'loo')
```




```{r}

data_all_conds_logistic2_configural = data_all_conds_logistic_configural %>%
  mutate(meaning = case_when(
    type == 'dim_sg_dim.sg' | type == 'big_pl_big.pl' ~ 'original',
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(dv), test = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot_configural = ggplot(data = data_all_conds_logistic2_configural, aes(x = meaning, y = invlogit(mean_freq_diff), fill = prod_condition)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  ggtitle('configural cues') +
  facet_wrap(~condition)


#observed estimates:
fixed_effects_df = read_csv('../Data/fixed_effects_df_all.csv') %>%
  filter(Task == 'prod')

observed_estimates = fixed_effects_df 


observed_estimates_plot = ggplot(data = observed_estimates, aes(x = Meaning, y = Prob, fill = Stem)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  facet_wrap(~Condition)



ggarrange(observed_estimates_plot, rw_plot_configural, nrow = 2, common.legend = T)
ggarrange(rw_plot, rw_plot_configural, nrow = 2, common.legend = T)
```
### Modified alpha

```{r}

semantic_cues = c('dim', 'pl', 'big', 'sg', 'big.pl', 'big.sg', 'dim.sg', 'dim.pl')

data_cond1_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond1_configural[sample(1:nrow(data_cond1_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond2_configural[sample(1:nrow(data_cond2_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond3_configural[sample(1:nrow(data_cond3_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond4_configural[sample(1:nrow(data_cond4_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond5_configural[sample(1:nrow(data_cond5_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix_configural_mod_alpha = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond6_configural[sample(1:nrow(data_cond6_configural)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod = data_prod %>%
  mutate(type = case_when(
    type == 'dim_sg' ~ 'dim_sg_dim.sg',
    type == 'big_pl' ~ 'big_pl_big.pl',
    type == 'dim_pl' ~ 'dim_pl'
  ))

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)


#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix_configural_mod_alpha , by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)

data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_all_conds_configural = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_configural_modified_alpha = data_all_conds_configural

```

```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds_conf_sem = data_all_conds_configural %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)

data_all_conds_conf_sem %>%
  mutate(freq_minus_infreq = dv)

data_all_conds_for_comparison_conf_sem = data_all_conds_conf_sem %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, freq_minus_infreq, dan_activations, nem_activations, sil_activations, shoon_activations)

data_all_conds_for_comparison_conf_sem = data_all_conds_for_comparison_conf_sem %>%
  mutate(picture_meaning = case_when(
    picture_meaning == 'dim_sg_dim.sg' ~ 'dim_sg',
    picture_meaning == 'big_pl_big.pl' ~ 'big_pl',
    .default = picture_meaning
  ))

human_data_no_sil_no_shoon_plus_rw_preds_sem_alpha = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison_conf_sem)
  
```

#### model
```{r}
priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))

model_human_conf_sem_preds = brm(frequency ~ freq_minus_infreq + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_sem_alpha,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_conf_sem_preds')


model_human_conf_sem_preds = add_criterion(model_human_conf_sem_preds, 'loo')

model_human_conf_sem_preds_original_preds = brm(frequency ~ freq_minus_infreq + condition*meaning*stem_condition + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_sem_alpha,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_conf_sem_preds_original_preds')


model_human_conf_sem_preds_original_preds = add_criterion(model_human_conf_sem_preds_original_preds, 'loo')

```


#### loo compare with model without conf cues and different semantic salience value

```{r}
#compare with logistic and human model that don't have configural cues or different semantic salience value
loo_comparisons_conf_sem = data.frame(loo_compare(model_human_rw_preds, model_human_conf_sem_preds, model_prod_both_stem_simple_humans))

#write_csv(loo_comparisons_conf_sem, '../Data/loo_comparisons_conf_sem.csv')
```


### Modified alpha plot

```{r}

data_all_conds_logistic2_configural_modified_alpha = data_all_conds_configural_modified_alpha %>%
  mutate(meaning = case_when(
    type == 'dim_sg_dim.sg' | type == 'big_pl_big.pl' ~ 'original', #maybe need to filter out one of the meanings to avoid duplicates?
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot_configural_mod_alpha = ggplot(data = data_all_conds_logistic2_configural_modified_alpha, aes(x = meaning, y = invlogit(mean_freq_diff), fill = prod_condition)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  ggtitle('configural cues + mod alpha') +
  facet_wrap(~condition)


#write_csv(data_all_conds_logistic2_configural_modified_alpha, 'rw_plot_configural_mod_alpha.csv')

#observed estimates:
fixed_effects_df = read_csv('../Data/fixed_effects_df_all.csv') %>%
  filter(Task == 'prod')

observed_estimates = fixed_effects_df 


observed_estimates_plot = ggplot(data = observed_estimates, aes(x = Meaning, y = Prob, fill = Stem)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  ggtitle('human data') +
  facet_wrap(~Condition)

#rw_plot_configural_mod_alpha

ggarrange(observed_estimates_plot, rw_plot_configural, rw_plot_configural_mod_alpha, nrow = 3, common.legend = T)
```
## Alpha changed but no configural cues

```{r}

data_cond1_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond1[sample(1:nrow(data_cond1)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond2[sample(1:nrow(data_cond2)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond3[sample(1:nrow(data_cond3)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond4[sample(1:nrow(data_cond4)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond5[sample(1:nrow(data_cond5)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix_non_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla_modified_alpha_for_semantic_cues(cuesOutcomes = data_cond6[sample(1:nrow(data_cond6)), ], logistic = T))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})


data_prod = read_csv('../Conditions/production_condition.csv')

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   
data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)


#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix_non_configural, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix_non_configural, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix_non_configural, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix_non_configural, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix_non_configural, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix_non_configural, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)




data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) #%>%
  #filter(type != 'big_pl_big.pl')

data_all_conds_logistic_configural = data_all_conds_configural



data_all_conds_non_configural_modified_alpha = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_logistic_non_configural_modified_alpha = data_all_conds_non_configural_modified_alpha


```

```{r}
human_data_no_sil_no_shoon = read_csv('../Data/data_prod_no_sil_shoon.csv')
```

```{r}
data_all_conds_mod_sem_alpha = data_all_conds_non_configural_modified_alpha %>%
  rename('picture_meaning' = type) %>%
  rename('resp_stem' = prod_label) %>%
  rename('stem_condition' = prod_condition) %>%
  rename('original_condition' = condition)

data_all_conds_mod_sem_alpha %>%
  mutate(freq_minus_infreq = dv)

data_all_conds_for_comparison_mode_sem_alpha = data_all_conds_mod_sem_alpha %>%
  dplyr::select(original_condition, stem_condition, resp_stem, picture_meaning, freq_minus_infreq, dan_activations, nem_activations, sil_activations, shoon_activations)

data_all_conds_for_comparison_mode_sem_alpha = data_all_conds_for_comparison_mode_sem_alpha %>%
  mutate(picture_meaning = case_when(
    picture_meaning == 'dim_sg_dim.sg' ~ 'dim_sg',
    picture_meaning == 'big_pl_big.pl' ~ 'big_pl',
    .default = picture_meaning
  ))

human_data_no_sil_no_shoon_plus_rw_preds_nonconf_sem_alpha = human_data_no_sil_no_shoon %>%
  left_join(data_all_conds_for_comparison_mode_sem_alpha)
  
```

####  Models
```{r}
priors_m1 = c(
  prior(student_t(3, 0, 1), class = 'Intercept'), #0.5 might seem small, but in logistic regression this is still quite large since a-prior exp(1) = 2.7 is still plausible.
  prior(student_t(3, 0, 1), class = 'b'),
  prior(student_t(3, 0, 1), class = 'sd'))

model_human_mod_sem_alpha = brm(frequency ~ freq_minus_infreq + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_nonconf_sem_alpha,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_mod_sem_alpha')


model_human_mod_sem_alpha = add_criterion(model_human_mod_sem_alpha, 'loo')

model_human_mod_sem_alpha_original_preds = brm(frequency ~ freq_minus_infreq + condition*meaning*stem_condition + (1 | participant) + (1 | resp_stem),
                                       data = human_data_no_sil_no_shoon_plus_rw_preds_nonconf_sem_alpha,
                                       family = bernoulli(link = 'logit'),
                                       iter = 22000, 
                                       warmup = 1100,
                                       chains = 4,
                                       cores = 4,
                                       prior = priors_m1,
                                       control = list(adapt_delta = 0.99),
                                       save_pars = save_pars(all = TRUE),
                                       file = '../Data/model_human_mod_sem_alpha_original_preds')


model_human_mod_sem_alpha_original_preds = add_criterion(model_human_mod_sem_alpha_original_preds, 'loo')
```



#### Plot

```{r}

data_all_conds_logistic2_non_configural_modified_alpha = data_all_conds_logistic_non_configural_modified_alpha %>%
  mutate(meaning = case_when(
    type == 'dim_sg' | type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot_non_configural = ggplot(data = data_all_conds_logistic2_non_configural_modified_alpha, aes(x = meaning, y = invlogit(mean_freq_diff), fill = prod_condition)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  ggtitle('non-configural cues') +
  facet_wrap(~condition)


#observed estimates:
fixed_effects_df = read_csv('../Data/fixed_effects_df_all.csv') %>%
  filter(Task == 'prod')

observed_estimates = fixed_effects_df 


observed_estimates_plot = ggplot(data = observed_estimates, aes(x = Meaning, y = Prob, fill = Stem)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  facet_wrap(~Condition)



ggarrange(observed_estimates_plot, rw_plot_non_configural, nrow = 2, common.legend = T)
```

```{r}
ggarrange(rw_plot_configural, rw_plot_non_configural, nrow = 2)
```

```{r}
## Rescorla function

n_sims = 1

data_cond1_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond1[sample(1:nrow(data_cond1)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond2[sample(1:nrow(data_cond2)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond3[sample(1:nrow(data_cond3)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond4[sample(1:nrow(data_cond4)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond5[sample(1:nrow(data_cond5)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond6[sample(1:nrow(data_cond6)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) %>%
  filter(type != 'big_pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) %>%
  filter(type != 'big_pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl'][1] - nem_activations[type == 'dim_sg'][1]
  )) %>%
  filter(type != 'big_pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) %>%
  filter(type != 'big_pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) %>%
  filter(type != 'big_pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg'][1] - dan_activations[type=='big_pl'][1]
  )) %>%
  filter(type != 'big_pl')


data_all_conds = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_not_logistic = data_all_conds
  
```

#### Plot

```{r}

data_all_conds_not_logistic2 = data_all_conds_not_logistic %>%
  mutate(meaning = case_when(
    type == 'dim_sg' | type == 'big_pl' ~ 'original',
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(dv), test = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot = ggplot(data = data_all_conds_not_logistic2, aes(x = meaning, y = mean_freq_diff, fill = prod_condition)) +
  geom_col(position = "dodge") +
  #ylim(c(0,1)) +
  facet_wrap(~condition)


#observed estimates:
fixed_effects_df = read_csv('../Data/fixed_effects_df_all.csv') %>%
  filter(Task == 'prod')

observed_estimates = fixed_effects_df 


observed_estimates_plot = ggplot(data = observed_estimates, aes(x = Meaning, y = Prob, fill = Stem)) +
  geom_col(position = "dodge") +
  ylim(c(0,1)) +
  facet_wrap(~Condition)


rw_plot
observed_estimates_plot

ggarrange(observed_estimates_plot, rw_plot, nrow = 2, common.legend = T)
```


### Reg RW w/ configural cues

```{r}

data_cond1_configural = data_cond1 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond2_configural = data_cond2 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond3_configural = data_cond3 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond4_configural = data_cond4 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond5_configural = data_cond5 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

data_cond6_configural = data_cond6 %>%
  mutate(Cues = case_when(
    str_ends(Cues, "big_pl") ~ paste0(Cues, "_big.pl"),
    str_ends(Cues, "big_sg") ~ paste0(Cues, "_big.sg"),
    str_ends(Cues, "dim_sg") ~ paste0(Cues, "_dim.sg"),
    TRUE ~ Cues  # leave unchanged if none of these endings
  ))

n_sims = 1

data_cond1_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond1_configural[sample(1:nrow(data_cond1_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond2_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond2_configural[sample(1:nrow(data_cond2_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond3_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond3_configural[sample(1:nrow(data_cond3_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond4_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond4_configural[sample(1:nrow(data_cond4_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})
  
data_cond5_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond5_configural[sample(1:nrow(data_cond5_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

data_cond6_rw_matrix_configural = map_dfr(1:n_sims, function(i) {
  result = as.data.frame(Rescorla(cuesOutcomes = data_cond6_configural[sample(1:nrow(data_cond6_configural)), ], logistic = F))
  result = rownames_to_column(result, var = 'cue')
  result$sim = i
  result
})

```

```{r}
data_prod = read_csv('../Conditions/production_condition.csv')
```

```{r}

data_prod = data_prod %>%
  mutate(stem = orthoCoding(prod_label)) %>%
  mutate(type = case_when(
    str_detect(file, 'dim_sg') ~ 'dim_sg',
    str_detect(file, '_2') ~ 'big_pl',
    str_detect(file, 'dim_pl') ~ 'dim_pl')
  ) %>%
  mutate(row_id = row_number())
   

data_prod = data_prod %>%
  mutate(type = case_when(
    type == 'dim_sg' ~ 'dim_sg_dim.sg',
    type == 'big_pl' ~ 'big_pl_big.pl',
    type == 'dim_pl' ~ 'dim_pl'
  ))

data_prod_cond1 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)


#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond1 = data_prod_cond1 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond1 = data_prod_cond1 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond1_rw_matrix_configural, by = c("key" = "cue"))

# data_prod_results_cond1 = data_prod_results_cond1 %>%
#   mutate(is.stem = case_when(
#     key %in% c('dim', 'big', 'sg', 'pl') ~ 0,
#     .default = 1
#   ))


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 1,
         freq_minus_infreq = dan_activations - nem_activations)


##c2
data_prod_cond2 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond2 = data_prod_cond2 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond2 = data_prod_cond2 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond2_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 2,
         freq_minus_infreq = dan_activations - nem_activations)



##c3
data_prod_cond3 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond3 = data_prod_cond3 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond3 = data_prod_cond3 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond3_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 3,
         freq_minus_infreq = dan_activations - nem_activations)


##c4
data_prod_cond4 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond4 = data_prod_cond4 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond4 = data_prod_cond4 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond4_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 4,
         freq_minus_infreq = nem_activations - dan_activations)




##c5
data_prod_cond5 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond5 = data_prod_cond5 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond5 = data_prod_cond5 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond5_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 5,
         freq_minus_infreq = nem_activations - dan_activations)




##c6
data_prod_cond6 = data_prod %>%
  mutate(key = paste0(stem, '_', type)) %>%
  dplyr::select(prod_condition, key)



#colnames(data_prod_cond1) = c('Stem Type', 'Cues')

data_prod_cond6 = data_prod_cond6 %>% 
  mutate(row_id = row_number()) 

data_prod_results_cond6 = data_prod_cond6 %>% 
  separate_rows(key, sep = "_") %>% 
  left_join(data_cond6_rw_matrix_configural, by = c("key" = "cue"))


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(row_id) %>%
  summarize(dan_activations = sum(dan, na.rm = T),
            sil_activations = sum(sil, na.rm = T),
            nem_activations = sum(nem, na.rm = T),
            shoon_activations = sum(shoon, na.rm = T)) %>%
  left_join(data_prod) %>%
  mutate(condition = 6,
         freq_minus_infreq = nem_activations - dan_activations)


data_prod_results_cond1 = data_prod_results_cond1 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')

data_prod_results_cond2 = data_prod_results_cond2 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')

data_prod_results_cond3 = data_prod_results_cond3 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~ dan_activations[type=='big_pl_big.pl'][1] - nem_activations[type == 'dim_sg_dim.sg'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')


data_prod_results_cond4 = data_prod_results_cond4 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')


data_prod_results_cond5 = data_prod_results_cond5 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')


data_prod_results_cond6 = data_prod_results_cond6 %>%
  group_by(prod_label) %>%
  mutate(dv = case_when(
    type == 'dim_pl' ~ freq_minus_infreq,
    type != 'dim_pl' ~  nem_activations[type == 'dim_sg_dim.sg'][1] - dan_activations[type=='big_pl_big.pl'][1]
  )) %>%
  filter(type != 'big_pl_big.pl')


data_all_conds_configural = rbind(
  data_prod_results_cond1,
  data_prod_results_cond2,
  data_prod_results_cond3,
  data_prod_results_cond4,
  data_prod_results_cond5,
  data_prod_results_cond6
  )

data_all_conds_logistic_configural = data_all_conds_configural
  
```
#### Plot

```{r}

data_all_conds_logistic2_configural = data_all_conds_logistic_configural %>%
  mutate(meaning = case_when(
    type == 'dim_sg_dim.sg' | type == 'big_pl_big.pl' ~ 'original',
    type == 'dim_pl' ~ 'novel'
  )) %>%
  mutate(condition = case_when(
    condition == 1 ~ 1,
    condition == 2 ~ 2,
    condition == 3 ~ 3, 
    condition == 4 ~ 1, 
    condition == 5 ~ 2,
    condition == 6 ~ 3
  )) %>%
  group_by(meaning, prod_condition, condition) %>%
  summarize(mean_freq_diff = mean(dv), test = mean(freq_minus_infreq), .groups = 'keep')

#rw plot:
# data_prod_results_for_plotting2 = data_prod_results_for_plotting %>%
#   group_by(meaning, prod_condition, condition) %>%
#   summarize(total_mean = sum(`mean(freq_minus_infreq)`), .groups = 'drop') %>%
#   filter(condition %in% c(1,2,3)) %>%
#   filter(meaning != 'infrequent')
 
#write_csv(data_all_conds_logistic2, '../Data/data_all_conds_logistic.csv')
 
rw_plot_configural = ggplot(data = data_all_conds_logistic2_configural, aes(x = meaning, y = mean_freq_diff, fill = prod_condition)) +
  geom_col(position = "dodge") +
  #ylim(c(0,1)) +
  facet_wrap(~condition)

rw_plot_configural

ggarrange(rw_plot_configural, rw_plot, nrow = 2)
```
# Final Loo Comparison

